
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://quarkus.io/quarkus-workshop-langchain4j/section-2/step-03/">
      
      
        <link rel="prev" href="../step-02/">
      
      
        <link rel="next" href="../step-04/">
      
      
        
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Step 3 - Composing multiple agentic workflows - Quarkus LangChain4j Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/panzoom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <meta name="panzoom-theme" content="material">
<meta name="panzoom-data" content='{"selectors": [".mermaid", ".d2"], "initial_zoom_level": 1.0}'> </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-03-composing-multiple-agentic-workflows" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You are not viewing the latest version.
<a href="../../..">
    <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Quarkus LangChain4j Workshop" class="md-header__button md-logo" aria-label="Quarkus LangChain4j Workshop" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Quarkus LangChain4j Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Step 3 - Composing multiple agentic workflows
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H6zm7-4.68V17c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-2.26C3.19 13.47 2 11.38 2 9c0-3.87 3.13-7 7-7 1.65 0 3.16.57 4.35 1.5C10.8 4.57 9 7.07 9 10c0 2.79 1.64 5.19 4 6.32m7.92-6.38-1.42-.91-1.4.97.4-1.65-1.33-1.03 1.68-.11.56-1.61.63 1.58 1.68.04-1.3 1.08zM19.39 13c-1.89 2.27-5.36 2.19-7.17-.05C10 10.13 11.56 6 15 5.34c.34-.05.64.29.5.63-.45 1.28-.38 2.74.35 4a4.62 4.62 0 0 0 3.27 2.28c.35.05.5.49.27.75"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 6a6 6 0 0 1 6 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1.8c-1.79-1.04-3-2.98-3-5.2a6 6 0 0 1 6-6m2 15v1a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1zm6-10h3v2h-3zM1 11h3v2H1zM13 1v3h-2V1zM4.92 3.5l2.13 2.14-1.42 1.41L3.5 4.93zm12.03 2.13 2.12-2.13 1.43 1.43-2.13 2.12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/quarkusio/quarkus-langchain4j-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Quarkus LangChain4j Workshop" class="md-nav__button md-logo" aria-label="Quarkus LangChain4j Workshop" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Quarkus LangChain4j Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/quarkusio/quarkus-langchain4j-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Requirements
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Section 1 - AI Apps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Section 1 - AI Apps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 1 - Introduction to Quarkus LangChain4j
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 2 - Playing with model parameters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 3 - Streaming responses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 4 - Using system messages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 5 - Introduction to the RAG pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 6 - Deconstructing the RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 7 - Function calling and tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 8 - Model Context Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 9 - Guardrails
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 10 - Observability and Fault Tolerance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Section 2 - Agentic Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Section 2 - Agentic Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 1 - Implementing AI Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 2 - Creating simple agentic workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Step 3 - Composing multiple agentic workflows
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 3 - Composing multiple agentic workflows
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#composing-multiple-agentic-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Composing Multiple Agentic Workflows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-requirement-from-miles-of-smiles-management-comprehensive-car-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        New Requirement from Miles of Smiles Management: Comprehensive Car Management
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-learn" class="md-nav__link">
    <span class="md-ellipsis">
      
        What You&rsquo;ll Learn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composing-agentic-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Composing Agentic Workflows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Composing Agentic Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-agentic-workflow-nesting" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Agentic Workflow Nesting?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-nested-agentic-workflow-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Nested Agentic Workflow Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-agenticscope-works-with-nesting" class="md-nav__link">
    <span class="md-ellipsis">
      
        How AgenticScope Works with Nesting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-being-added" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Being Added?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What is Being Added?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-complete-solution-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Complete Solution Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Implementation Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-each-level-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Each Level Works
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How Each Level Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-1-main-sequential-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 1: Main Sequential Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2a-parallel-feedback-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2a: Parallel Feedback Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2b-conditional-action-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2b: Conditional Action Workflow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-the-complete-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Try the Complete Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Try the Complete Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Start the Application
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-different-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Different Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Different Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-maintenance-priority" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 1: Maintenance Priority
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-cleaning-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 2: Cleaning Only
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-maintenance-return" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 3: Maintenance Return
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check the Logs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-nested-workflows-matter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Nested Workflows Matter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Nested Workflows Matter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#separation-of-concerns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Separation of Concerns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reusability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reusability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type Safety
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agenticscope-across-levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        AgenticScope Across Levels
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-implement-it-yourself" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional: Implement It Yourself
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional: Implement It Yourself">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-youll-build" class="md-nav__link">
    <span class="md-ellipsis">
      
        What You&rsquo;ll Build
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-feedback-analysis-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Feedback Analysis Agents
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Feedback Analysis Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintenancefeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        MaintenanceFeedbackAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaningfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        CleaningFeedbackAgent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-parallel-feedback-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create the Parallel Feedback Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-car-specialist-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Car Specialist Agents
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Car Specialist Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintenanceagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        MaintenanceAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-cleaningagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update CleaningAgent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-conditional-car-assignment-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create the Conditional Car Assignment Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-carconditionfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update CarConditionFeedbackAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-supporting-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Supporting Infrastructure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Supporting Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-maintenance-tool-for-function-calling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a Maintenance Tool for function calling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-carassignment-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create CarAssignment Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-carconditions-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update CarConditions Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-main-car-processing-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update the main Car Processing Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-service-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update the Service Layer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Your Implementation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-further" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experiment Further
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Experiment Further">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-add-priority-levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Add Priority Levels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-make-feedback-analysis-sequential" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Make Feedback Analysis Sequential
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-more-sophisticated-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Add More Sophisticated Conditions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-visualize-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Visualize the Workflow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      
        What&rsquo;s Next?
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 4 - Supervisor pattern for dynamic orchestration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 5 - Using remote agents (A2A)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step 6 - Human-in-the-Loop pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conclusion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mastering Agentic Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../conclusion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#composing-multiple-agentic-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Composing Multiple Agentic Workflows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-requirement-from-miles-of-smiles-management-comprehensive-car-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        New Requirement from Miles of Smiles Management: Comprehensive Car Management
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-learn" class="md-nav__link">
    <span class="md-ellipsis">
      
        What You&rsquo;ll Learn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composing-agentic-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Composing Agentic Workflows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Composing Agentic Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-agentic-workflow-nesting" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Agentic Workflow Nesting?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-nested-agentic-workflow-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Nested Agentic Workflow Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-agenticscope-works-with-nesting" class="md-nav__link">
    <span class="md-ellipsis">
      
        How AgenticScope Works with Nesting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-being-added" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Being Added?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What is Being Added?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-complete-solution-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Complete Solution Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Implementation Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-each-level-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Each Level Works
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How Each Level Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-1-main-sequential-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 1: Main Sequential Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2a-parallel-feedback-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2a: Parallel Feedback Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2b-conditional-action-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2b: Conditional Action Workflow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-the-complete-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Try the Complete Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Try the Complete Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Start the Application
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-different-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Different Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Different Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-maintenance-priority" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 1: Maintenance Priority
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-cleaning-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 2: Cleaning Only
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-maintenance-return" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 3: Maintenance Return
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check the Logs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-nested-workflows-matter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Nested Workflows Matter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Nested Workflows Matter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#separation-of-concerns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Separation of Concerns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reusability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reusability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type Safety
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agenticscope-across-levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        AgenticScope Across Levels
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-implement-it-yourself" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional: Implement It Yourself
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional: Implement It Yourself">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-youll-build" class="md-nav__link">
    <span class="md-ellipsis">
      
        What You&rsquo;ll Build
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-feedback-analysis-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Feedback Analysis Agents
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Feedback Analysis Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintenancefeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        MaintenanceFeedbackAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaningfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        CleaningFeedbackAgent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-parallel-feedback-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create the Parallel Feedback Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-car-specialist-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Car Specialist Agents
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Car Specialist Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintenanceagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        MaintenanceAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-cleaningagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update CleaningAgent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-conditional-car-assignment-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create the Conditional Car Assignment Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-carconditionfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update CarConditionFeedbackAgent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-supporting-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Supporting Infrastructure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Supporting Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-maintenance-tool-for-function-calling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a Maintenance Tool for function calling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-carassignment-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create CarAssignment Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-carconditions-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update CarConditions Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-main-car-processing-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update the main Car Processing Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-service-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update the Service Layer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-your-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Your Implementation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-further" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experiment Further
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Experiment Further">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-add-priority-levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Add Priority Levels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-make-feedback-analysis-sequential" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Make Feedback Analysis Sequential
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-more-sophisticated-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Add More Sophisticated Conditions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-visualize-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Visualize the Workflow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      
        What&rsquo;s Next?
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div><h1 id="step-03-composing-multiple-agentic-workflows">Step 03 - Composing Multiple Agentic Workflows<a class="headerlink" href="#step-03-composing-multiple-agentic-workflows" title="Permanent link"></a></h1>
<h2 id="composing-multiple-agentic-workflows">Composing Multiple Agentic Workflows<a class="headerlink" href="#composing-multiple-agentic-workflows" title="Permanent link"></a></h2>
<p>In the previous step, you created a <strong>sequential workflow</strong> that orchestrated two agents working together:</p>
<ol>
<li>The <code>CleaningAgent</code> determined if a car needed cleaning</li>
<li>The <code>CarConditionFeedbackAgent</code> updated the car’s condition based on feedback</li>
</ol>
<p>A single sequential pattern works well you just need agents to run one after another.
However, real-world scenarios often require more sophisticated orchestration patterns.</p>
<p>In this step, you’ll learn how to <strong>compose workflows by nesting them within other workflows</strong> to build complex
agentic systems, by creating multi-level orchestration patterns that combine mixed pattern executions.</p>
<hr>
<h2 id="new-requirement-from-miles-of-smiles-management-comprehensive-car-management">New Requirement from Miles of Smiles Management: Comprehensive Car Management<a class="headerlink" href="#new-requirement-from-miles-of-smiles-management-comprehensive-car-management" title="Permanent link"></a></h2>
<p>The Miles of Smiles management team wants a more sophisticated car management system.
When cars are returned, they want the system to automatically:</p>
<ol>
<li><strong>Analyze feedback</strong> for both cleaning needs AND maintenance requirements <strong>simultaneously</strong></li>
<li><strong>Route cars</strong> appropriately to maintenance if needed, otherwise to cleaning if needed</li>
<li><strong>Track all feedback sources</strong> from rentals, cleaning, and maintenance teams</li>
<li><strong>Update car conditions</strong> based on all collected feedback</li>
</ol>
<p>These new features require more advanced orchestration between agents to route requests appropriately.</p>
<hr>
<h2 id="what-youll-learn">What You’ll Learn<a class="headerlink" href="#what-youll-learn" title="Permanent link"></a></h2>
<p>In this step, you will:</p>
<ul>
<li>Understand how to <strong>nest workflows within workflows</strong> to create sophisticated multi-level orchestration</li>
<li>Explore additional types of workflow patterns such as <strong>parallel</strong> and <strong>conditional</strong></li>
<li>See how <code>AgenticScope</code> flows through nested workflow levels</li>
</ul>
<hr>
<h2 id="composing-agentic-workflows">Composing Agentic Workflows<a class="headerlink" href="#composing-agentic-workflows" title="Permanent link"></a></h2>
<p>Let’s start with a bit of theory. In <a href="../step-02/" target="_blank">Step 02</a>, you learned about the four fundamental workflow patterns: sequential, parallel, conditional, and loop. Now we’ll explore how to <strong>compose these patterns</strong> by nesting workflows within other workflows.</p>
<h3 id="what-is-agentic-workflow-nesting">What is Agentic Workflow Nesting?<a class="headerlink" href="#what-is-agentic-workflow-nesting" title="Permanent link"></a></h3>
<p>Workflow nesting means using a workflow as a sub-agent within another workflow. This allows you to:</p>
<ul>
<li><strong>Combine patterns</strong>: Use parallel execution within a sequential flow</li>
<li><strong>Organize complexity</strong>: Break down complex orchestration into manageable pieces</li>
<li><strong>Reuse workflows</strong>: Use the same sub-workflow in multiple places</li>
<li><strong>Create hierarchies</strong>: Build multi-level agent systems</li>
</ul>
<h3 id="example-nested-agentic-workflow-architecture">Example: Nested Agentic Workflow Architecture<a class="headerlink" href="#example-nested-agentic-workflow-architecture" title="Permanent link"></a></h3>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button><button class="panzoom-max panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"></path>
    </svg>
</button><button class="panzoom-min panzoom-button panzoom-hidden">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>graph TD
    Main[Main Workflow&lt;br/&gt;Sequential] --&gt; Sub1[Sub-Workflow 1&lt;br/&gt;Parallel]
    Main --&gt; Sub2[Sub-Workflow 2&lt;br/&gt;Conditional]
    Main --&gt; Agent[Single Agent]

    Sub1 --&gt; A1[Agent A]
    Sub1 --&gt; A2[Agent B]

    Sub2 --&gt; B1[Agent C]
    Sub2 --&gt; B2[Agent D]

    style Main fill:#90EE90
    style Sub1 fill:#87CEEB
    style Sub2 fill:#FFD700
    style Agent fill:#90EE90</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<p>This creates a <strong>three-level nested workflow</strong> where:</p>
<ul>
<li>The main sequential workflow coordinates the overall flow</li>
<li>Sub-workflows handle specific orchestration patterns (parallel, conditional)</li>
<li>Individual agents perform specific tasks</li>
</ul>
<h3 id="how-agenticscope-works-with-nesting">How AgenticScope Works with Nesting<a class="headerlink" href="#how-agenticscope-works-with-nesting" title="Permanent link"></a></h3>
<p>When workflows are nested, the <code>AgenticScope</code> flows through all levels:</p>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button><button class="panzoom-max panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"></path>
    </svg>
</button><button class="panzoom-min panzoom-button panzoom-hidden">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>graph LR
    A[Main Workflow&lt;br/&gt;AgenticScope] --&gt; B[Sub-Workflow 1&lt;br/&gt;Same Scope]
    B --&gt; C[Agent A&lt;br/&gt;Same Scope]
    B --&gt; D[Agent B&lt;br/&gt;Same Scope]
    A --&gt; E[Sub-Workflow 2&lt;br/&gt;Same Scope]</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<p><strong>Key points:</strong></p>
<ul>
<li>All nested workflows and agents share the <strong>same <code>AgenticScope</code> instance</strong></li>
<li>Data written by any agent is available to all subsequent agents</li>
<li>The scope maintains state throughout the entire execution hierarchy</li>
</ul>
<hr>
<h2 id="what-is-being-added">What is Being Added?<a class="headerlink" href="#what-is-being-added" title="Permanent link"></a></h2>
<p>Now that we have that bit of theory under out belt, we can continue to transform our car management system.
We’re going to implement:</p>
<ul>
<li><strong>3 feedback sources</strong>: collect <em>human</em> feedback not only from the car rental returns team, but also from the cleaning team, and from the maintenance team</li>
<li><strong>Parallel analysis</strong>: do concurrent evaluation for both cleaning and maintenance needs</li>
<li><strong>Conditional routing</strong>: implement intelligent decision-making about where to send each car</li>
<li><strong>Update the system</strong>: add additional Tools the agents can call to update the car conditions in the database based on all feedback</li>
</ul>
<h3 id="the-complete-solution-architecture">The Complete Solution Architecture<a class="headerlink" href="#the-complete-solution-architecture" title="Permanent link"></a></h3>
<p>The final system uses a 3-level nested workflow, similar to what we saw above in the theoretical part:</p>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button><button class="panzoom-max panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"></path>
    </svg>
</button><button class="panzoom-min panzoom-button panzoom-hidden">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>graph TB
    Start([Car Return]) --&gt; A[CarProcessingWorkflow&lt;br/&gt;Sequential - Level 1]

    A --&gt; B[Step 1: FeedbackWorkflow&lt;br/&gt;Parallel - Level 2]
    B --&gt; B1[CleaningFeedbackAgent]
    B --&gt; B2[MaintenanceFeedbackAgent]
    B1 --&gt; BEnd[Both complete]
    B2 --&gt; BEnd

    BEnd --&gt; C[Step 2: CarAssignmentWorkflow&lt;br/&gt;Conditional - Level 2]
    C --&gt; C1{Maintenance&lt;br/&gt;needed?}
    C1 --&gt;|Yes| C2[MaintenanceAgent]
    C1 --&gt;|No| C3{Cleaning&lt;br/&gt;needed?}
    C3 --&gt;|Yes| C4[CleaningAgent]
    C3 --&gt;|No| C5[Skip both]
    C2 --&gt; CEnd[Action complete]
    C4 --&gt; CEnd
    C5 --&gt; CEnd

    CEnd --&gt; D[Step 3: CarConditionFeedbackAgent&lt;br/&gt;Single Agent - Level 1]
    D --&gt; End([Updated Car Conditions])

    style A fill:#90EE90
    style B fill:#87CEEB
    style C fill:#FFD700
    style D fill:#90EE90
    style Start fill:#E8E8E8
    style End fill:#E8E8E8
    style BEnd fill:#F0F0F0
    style CEnd fill:#F0F0F0</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<p><strong>The Flow:</strong></p>
<ol>
<li>
<p><strong>FeedbackWorkflow</strong> (Parallel): Analyzes feedback simultaneously from two perspectives:</p>
<ul>
<li>Does the car need maintenance?</li>
<li>Does the car need cleaning?</li>
</ul>
</li>
<li>
<p><strong>CarAssignmentWorkflow</strong> (Conditional): Routes the car based on the analysis:</p>
<ul>
<li>If maintenance needed, then send to maintenance team</li>
<li>Else if cleaning needed, then send to cleaning</li>
<li>Else: do nothing</li>
</ul>
</li>
<li>
<p><strong>CarConditionFeedbackAgent</strong> (Single): Updates the car’s condition based on all feedback</p>
</li>
</ol>
<hr>
<h3 id="key-implementation-details">Key Implementation Details<a class="headerlink" href="#key-implementation-details" title="Permanent link"></a></h3>
<h3 id="how-each-level-works">How Each Level Works<a class="headerlink" href="#how-each-level-works" title="Permanent link"></a></h3>
<h4 id="level-1-main-sequential-workflow">Level 1: Main Sequential Workflow<a class="headerlink" href="#level-1-main-sequential-workflow" title="Permanent link"></a></h4>
<p>The <code>CarProcessingWorkflow</code> orchestrates the entire process sequentially:</p>
<div class="highlight"><span class="filename">CarProcessingWorkflow.java</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="hll"><span class="nd">@SequenceAgent</span><span class="p">(</span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">,</span>
</span><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="hll"><span class="w">        </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FeedbackWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">CarAssignmentWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">CarConditionFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
</span></code></pre></div>
<p>Notice that <code>subAgents</code> contains <strong>two workflows</strong> and one agent. Workflows are first-class citizens that can be nested just like agents.</p>
<h4 id="level-2a-parallel-feedback-workflow">Level 2a: Parallel Feedback Workflow<a class="headerlink" href="#level-2a-parallel-feedback-workflow" title="Permanent link"></a></h4>
<p>The <code>FeedbackWorkflow</code> runs multiple agents <strong>simultaneously</strong>:</p>
<div class="highlight"><span class="filename">FeedbackWorkflow.java</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="hll"><span class="nd">@ParallelAgent</span><span class="p">(</span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"feedbackResult"</span><span class="p">,</span>
</span><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="hll"><span class="w">        </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CleaningFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">MaintenanceFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
</span></code></pre></div>
<p>The agents analyze different aspects (cleaning vs. maintenance) and don’t depend on each other, so running them concurrently improves performance.</p>
<h4 id="level-2b-conditional-action-workflow">Level 2b: Conditional Action Workflow<a class="headerlink" href="#level-2b-conditional-action-workflow" title="Permanent link"></a></h4>
<p>The <code>CarAssignmentWorkflow</code> uses <strong>activation conditions</strong> to intelligently route cars to the appropriate team based on the analysis it has done:</p>
<div class="highlight"><span class="filename">CarAssignmentWorkflow.java</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="hll"><span class="nd">@ConditionalAgent</span><span class="p">(</span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"analysisResult"</span><span class="p">,</span>
</span><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">        </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w">  </span><span class="n">CleaningAgent</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">String</span><span class="w"> </span><span class="nf">processAction</span><span class="p">(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">,</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="hll"><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">assignToMaintenance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">}</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="hll"><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">CleaningAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">assignToCleaning</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">cleaningRequest</span><span class="p">);</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="p">}</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="hll"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">"NOT_REQUIRED"</span><span class="p">);</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>If <code>assignToMaintenance()</code> returns <code>true</code> → MaintenanceAgent runs, CleaningAgent skipped</li>
<li>Else if <code>assignToCleaning()</code> returns <code>true</code> → CleaningAgent runs</li>
<li>Else → Both skipped</li>
</ul>
<p>This implements <strong>priority routing</strong>: maintenance takes precedence over cleaning.</p>
<hr>
<h2 id="try-the-complete-solution">Try the Complete Solution<a class="headerlink" href="#try-the-complete-solution" title="Permanent link"></a></h2>
<p>Now that you understand the architecture, let’s see it in action!</p>
<h3 id="start-the-application">Start the Application<a class="headerlink" href="#start-the-application" title="Permanent link"></a></h3>
<ol>
<li>Navigate to the complete solution directory:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span>section-2/step-03
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>./mvnw<span class="w"> </span>quarkus:dev
</code></pre></div>
<ol>
<li>Open <a href="http://localhost:8080" target="_blank">http://localhost:8080</a></li>
</ol>
<h3 id="test-different-scenarios">Test Different Scenarios<a class="headerlink" href="#test-different-scenarios" title="Permanent link"></a></h3>
<p>Try these scenarios to see how the nested workflows route cars:</p>
<h4 id="scenario-1-maintenance-priority">Scenario 1: Maintenance Priority<a class="headerlink" href="#scenario-1-maintenance-priority" title="Permanent link"></a></h4>
<p>Enter the following text in the feedback field for the Honda Civic:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Engine making strange noise and car is dirty
</code></pre></div>
<p><strong>What happens:</strong></p>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button><button class="panzoom-max panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"></path>
    </svg>
</button><button class="panzoom-min panzoom-button panzoom-hidden">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>flowchart TD
    Start([Input: Engine making strange noise&lt;br/&gt;and car is dirty])

    Start --&gt; FW[FeedbackWorkflow&lt;br/&gt;Parallel Analysis]

    FW --&gt; MFA[MaintenanceFeedbackAgent]
    FW --&gt; CFA[CleaningFeedbackAgent]

    MFA --&gt; MR[Detects: maintenance needed ✓]
    CFA --&gt; CR[Detects: cleaning needed ✓]

    MR --&gt; CAW{CarAssignmentWorkflow&lt;br/&gt;Conditional Routing}
    CR --&gt; CAW

    CAW --&gt;|Maintenance has higher priority| MA[Route to MaintenanceAgent]
    MA --&gt; Result([Result: Car goes to maintenance])

    style FW fill:#FAE5D3
    style CAW fill:#D5F5E3
    style MA fill:#F9E79F
    style Result fill:#D2B4DE</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<h4 id="scenario-2-cleaning-only">Scenario 2: Cleaning Only<a class="headerlink" href="#scenario-2-cleaning-only" title="Permanent link"></a></h4>
<p>Enter the following text in the Mercedes Benz feedback field:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Car is very dirty but runs fine
</code></pre></div>
<p><strong>What happens:</strong></p>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button><button class="panzoom-max panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"></path>
    </svg>
</button><button class="panzoom-min panzoom-button panzoom-hidden">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>flowchart TD
    Start([Input: Car is very dirty&lt;br/&gt;but runs fine])

    Start --&gt; FW[FeedbackWorkflow&lt;br/&gt;Parallel Analysis]

    FW --&gt; MFA[MaintenanceFeedbackAgent]
    FW --&gt; CFA[CleaningFeedbackAgent]

    MFA --&gt; MR[Detects: no maintenance needed ✗]
    CFA --&gt; CR[Detects: cleaning needed ✓]

    MR --&gt; CAW{CarAssignmentWorkflow&lt;br/&gt;Conditional Routing}
    CR --&gt; CAW

    CAW --&gt;|No maintenance needed, 2nd priority is cleaning| CA[Route to CleaningAgent]
    CA --&gt; Result([Result: Car goes to cleaning])

    style FW fill:#FAE5D3
    style CAW fill:#D5F5E3
    style CA fill:#F9E79F
    style Result fill:#D2B4DE</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<h4 id="scenario-3-maintenance-return">Scenario 3: Maintenance Return<a class="headerlink" href="#scenario-3-maintenance-return" title="Permanent link"></a></h4>
<p>Now use the “Maintenance Return” tab and enter in the For F-150 field:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Fixed the brakes, car could use a wash now
</code></pre></div>
<p><strong>What happens:</strong></p>
<ul>
<li>FeedbackWorkflow: Analyzes maintenance feedback</li>
<li>CarAssignmentWorkflow: Routes to CleaningAgent</li>
<li>Result: Car goes to cleaning after maintenance</li>
</ul>
<h3 id="check-the-logs">Check the Logs<a class="headerlink" href="#check-the-logs" title="Permanent link"></a></h3>
<p>Watch the console output to see the workflow execution:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>FeedbackWorkflow<span class="w"> </span>executing...
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span>├─<span class="w"> </span>CleaningFeedbackAgent<span class="w"> </span>analyzing...
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span>└─<span class="w"> </span>MaintenanceFeedbackAgent<span class="w"> </span>analyzing...
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>CarAssignmentWorkflow<span class="w"> </span>evaluating<span class="w"> </span>conditions...
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span>└─<span class="w"> </span>MaintenanceAgent<span class="w"> </span>activated
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>CarConditionFeedbackAgent<span class="w"> </span>updating...
</code></pre></div>
<p>Notice how the parallel agents execute simultaneously, then the conditional workflow makes routing decisions!</p>
<hr>
<h2 id="why-nested-workflows-matter">Why Nested Workflows Matter<a class="headerlink" href="#why-nested-workflows-matter" title="Permanent link"></a></h2>
<h3 id="separation-of-concerns">Separation of Concerns<a class="headerlink" href="#separation-of-concerns" title="Permanent link"></a></h3>
<p>Each workflow has a single responsibility:</p>
<ul>
<li><strong>FeedbackWorkflow</strong>: Analyze all feedback sources</li>
<li><strong>CarAssignmentWorkflow</strong>: Route cars to appropriate teams</li>
<li><strong>CarProcessingWorkflow</strong>: Orchestrate the complete process</li>
</ul>
<p>This makes the system easier to understand, test, and modify.</p>
<h3 id="reusability">Reusability<a class="headerlink" href="#reusability" title="Permanent link"></a></h3>
<p>Workflows are <strong>reusable components</strong>. For example, you could use <code>FeedbackWorkflow</code> in other contexts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">// Use in a different workflow</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nd">@SequenceAgent</span><span class="p">(</span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="n">FeedbackWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w">  </span><span class="c1">// Reuse the same workflow!</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">SomeOtherAgent</span><span class="p">.</span><span class="na">class</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">})</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DifferentWorkflow</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Workflow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3 id="type-safety">Type Safety<a class="headerlink" href="#type-safety" title="Permanent link"></a></h3>
<p>The entire nested structure is <strong>type-checked at compile time</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">// This won't compile if the workflow structure is invalid</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">CarProcessingWorkflow</span><span class="w"> </span><span class="n">workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AiServices</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">CarProcessingWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="n">chatLanguageModel</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">);</span>
</code></pre></div>
<h3 id="agenticscope-across-levels">AgenticScope Across Levels<a class="headerlink" href="#agenticscope-across-levels" title="Permanent link"></a></h3>
<p>The <code>AgenticScope</code> flows through all levels of nesting:</p>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button><button class="panzoom-max panzoom-button">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"></path>
    </svg>
</button><button class="panzoom-min panzoom-button panzoom-hidden">
    <svg class="panzoom-icon" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>sequenceDiagram
    participant Main as CarProcessingWorkflow
    participant Feedback as FeedbackWorkflow
    participant Action as ActionWorkflow
    participant Scope as AgenticScope

    Main-&gt;&gt;Scope: Store: rentalFeedback, cleaningFeedback, maintenanceFeedback

    Note over Feedback: Level 2 - Parallel
    Main-&gt;&gt;Feedback: Execute
    Feedback-&gt;&gt;Scope: Write: maintenanceRequest, cleaningRequest

    Note over Action: Level 2 - Conditional
    Main-&gt;&gt;Action: Execute
    Action-&gt;&gt;Scope: Read: maintenanceRequest, cleaningRequest
    Action-&gt;&gt;Scope: Execute selected agent

    Main-&gt;&gt;Scope: Final agent updates condition</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<p>All agents and workflows share the same scope, enabling seamless data flow across levels.</p>
<hr>
<h2 id="optional-implement-it-yourself">Optional: Implement It Yourself<a class="headerlink" href="#optional-implement-it-yourself" title="Permanent link"></a></h2>
<p>If you want hands-on practice implementing these patterns, you can build the solution step-by-step.</p>
<div class="admonition warning">
<p class="admonition-title">Short on time?</p>
<p>There are quite a few changes to make,
so if you’re short on time and would like to learn about the next concepts,
feel free to skip to the next step.
As a middle-of-the-road solution, you can also read on and walk through the implementation
steps in the source code of section-2/step-03 without making all the code changes yourself.</p>
</div>
<h3 id="what-youll-build">What You’ll Build<a class="headerlink" href="#what-youll-build" title="Permanent link"></a></h3>
<p>Starting from your current code in <code>section-2/step-02</code>, you’ll add:</p>
<ol>
<li><strong>Feedback Analysis Agents</strong> (MaintenanceFeedbackAgent, CleaningFeedbackAgent)</li>
<li><strong>Parallel Feedback Workflow</strong> to run them concurrently</li>
<li><strong>Action Agents</strong> (MaintenanceAgent, updated CleaningAgent)</li>
<li><strong>Conditional Action Workflow</strong> for intelligent routing</li>
<li><strong>Nested Main Workflow</strong> that orchestrates everything</li>
<li><strong>Supporting Infrastructure</strong> (tools, models, service updates)</li>
</ol>
<p><strong>Time:</strong> 60-90 minutes (20-30 minutes if you’re working directly from step-03)</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h3>
<p>Before starting:</p>
<ul>
<li>Completed <a href="../step-02/" target="_blank">Step 02</a> (or have the <code>section-2/step-02</code> code available)</li>
<li>Application from Step 02 is stopped (Ctrl+C)</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">Option 1: Continue from Step 02</label><label for="__tabbed_1_2">Option 2: Start Fresh from Step 03 [Recommended]</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>If you want to continue building on your Step 02 code, you’ll need to copy the updated UI files from <code>step-03</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1">Linux / macOS</label><label for="__tabbed_2_2">Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>cp<span class="w"> </span>../step-03/src/main/resources/META-INF/resources/css/styles.css<span class="w"> </span>./src/main/resources/META-INF/resources/css/styles.css
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>cp<span class="w"> </span>../step-03/src/main/resources/META-INF/resources/js/app.js<span class="w"> </span>./src/main/resources/META-INF/resources/js/app.js
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>cp<span class="w"> </span>../step-03/src/main/resources/META-INF/resources/index.html<span class="w"> </span>./src/main/resources/META-INF/resources/index.html
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>cp<span class="w"> </span>../step-03/src/main/resources/import.sql<span class="w"> </span>./src/main/resources/import.sql
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>cp<span class="w"> </span>../step-03/src/main/java/com/carmanagement/model/CarStatus.java<span class="w"> </span>./src/main/java/com/carmanagement/model/CarStatus.java
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>copy ..\step-03\src\main\resources\META-INF\resources\css\styles.css .\src\main\resources\META-INF\resources\css\styles.css
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>copy ..\step-03\src\main\resources\META-INF\resources\js\app.js .\src\main\resources\META-INF\resources\js\app.js
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>copy ..\step-03\src\main\resources\META-INF\resources\index.html .\src\main\resources\META-INF\resources\index.html
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>copy ..\step-03\src\main\resources\import.sql .\src\main\resources\import.sql
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>copy ..\step-03\src\main\java\com\carmanagement\service\CarService.java .\src\main\java\com\carmanagement\service\CarService.java
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>copy ..\step-03\src\main\java\com\carmanagement\model\CarStatus.java .\src\main\java\com\carmanagement\model\CarStatus.java
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<p>If you prefer to start with the complete Step 03 code, and walk through the code instead of implementing everything yourself:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">cd</span><span class="w"> </span>section-2/step-03
</code></pre></div>
</div>
</div>
</div>
<h3 id="create-feedback-analysis-agents">Create Feedback Analysis Agents<a class="headerlink" href="#create-feedback-analysis-agents" title="Permanent link"></a></h3>
<h4 id="maintenancefeedbackagent">MaintenanceFeedbackAgent<a class="headerlink" href="#maintenancefeedbackagent" title="Permanent link"></a></h4>
<p>Create <code>src/main/java/com/carmanagement/agentic/agents/MaintenanceFeedbackAgent.java</code>:</p>
<div class="highlight"><span class="filename">MaintenanceFeedbackAgent.java</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="cm">/**</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="cm"> * Agent that analyzes feedback to determine if maintenance is needed.</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="cm"> */</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="hll"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MaintenanceFeedbackAgent</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="s">        You are a car maintenance analyzer for a car rental company. Your job is to determine if a car needs maintenance based on feedback.</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="s">        Analyze the feedback and car information to decide if maintenance is needed.</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="s">        If the feedback mentions mechanical issues, strange noises, performance problems, significant body damage or anything that suggests</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="s">        the car needs maintenance, recommend appropriate maintenance.</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="hll"><span class="s">        Be specific about what type of maintenance is needed (oil change, tire rotation, brake service, engine service, transmission service, body work).</span>
</span><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="hll"><span class="s">        If no service of any kind, repairs or maintenance are needed, respond with "MAINTENANCE_NOT_REQUIRED".</span>
</span><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="s">        Include the reason for your choice but keep your response short.</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="s">        Car Information:</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="s">        Previous Condition: {carCondition}</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="s">        Feedback:</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="hll"><span class="s">        Rental Feedback: {rentalFeedback}</span>
</span><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="hll"><span class="s">        Cleaning Feedback: {cleaningFeedback}</span>
</span><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="hll"><span class="s">        Maintenance Feedback: {maintenanceFeedback}</span>
</span><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car maintenance analyzer. Using feedback, determines if a car needs maintenance."</span><span class="p">,</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="hll"><span class="w">            </span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"maintenanceRequest"</span><span class="p">)</span>
</span><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeForMaintenance</span><span class="p">(</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningFeedback</span><span class="p">,</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Focuses on mechanical issues, body damage, and maintenance needs</li>
<li>Returns “MAINTENANCE_NOT_REQUIRED” for easy conditional checking</li>
<li>Uses <code>outputKey</code> to store result in AgenticScope</li>
</ul>
<h4 id="cleaningfeedbackagent">CleaningFeedbackAgent<a class="headerlink" href="#cleaningfeedbackagent" title="Permanent link"></a></h4>
<p>Create <code>src/main/java/com/carmanagement/agentic/agents/CleaningFeedbackAgent.java</code>:</p>
<div class="highlight"><span class="filename">CleaningFeedbackAgent.java</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="cm">/**</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="cm"> * Agent that analyzes feedback to determine if a cleaning is needed.</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="cm"> */</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CleaningFeedbackAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="s">        You are a cleaning analyzer for a car rental company. Your job is to determine if a car needs cleaning based on feedback.</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="s">        Analyze the feedback and car information to decide if a cleaning is needed.</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="s">        If the feedback mentions dirt, mud, stains, or anything that suggests the car is dirty, recommend a cleaning.</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="hll"><span class="s">        Be specific about what type of cleaning is needed (exterior, interior, detailing, waxing).</span>
</span><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="hll"><span class="s">        If no interior or exterior car cleaning services are needed based on the feedback, respond with "CLEANING_NOT_REQUIRED".</span>
</span><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="s">        Include the reason for your choice but keep your response short.</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="s">        Car Information:</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="s">        Previous Condition: {carCondition}</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="s">        Feedback:</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="hll"><span class="s">        Rental Feedback: {rentalFeedback}</span>
</span><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="hll"><span class="s">        Cleaning Feedback: {cleaningFeedback}</span>
</span><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="hll"><span class="s">        Maintenance Feedback: {maintenanceFeedback}</span>
</span><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Cleaning analyzer. Using feedback, determines if a cleaning is needed."</span><span class="p">,</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="hll"><span class="w">            </span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"cleaningRequest"</span><span class="p">)</span>
</span><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeForCleaning</span><span class="p">(</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningFeedback</span><span class="p">,</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Focuses on cleanliness issues</li>
<li>Returns “CLEANING_NOT_REQUIRED” when no cleaning needed</li>
<li>Stores result in AgenticScope for later use</li>
</ul>
<h3 id="create-the-parallel-feedback-workflow">Create the Parallel Feedback Workflow<a class="headerlink" href="#create-the-parallel-feedback-workflow" title="Permanent link"></a></h3>
<p>Now, we’ll create a <strong>parallel</strong> workflow that runs both feedback agents simultaneously.
This is where the <code>@ParallelAgent</code> annotation comes into play.</p>
<p>Create <code>src/main/java/com/carmanagement/agentic/workflow/FeedbackWorkflow.java</code>:</p>
<div class="highlight"><span class="filename">FeedbackWorkflow.java</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.CleaningFeedbackAgent</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.MaintenanceFeedbackAgent</span><span class="p">;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.ParallelAgent</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="cm">/**</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="cm"> * Workflow for processing car feedback in parallel.</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="cm"> */</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">FeedbackWorkflow</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="cm">     * Runs multiple feedback agents in parallel to analyze different aspects of car feedback.</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="cm">     */</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="hll"><span class="w">    </span><span class="nd">@ParallelAgent</span><span class="p">(</span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"feedbackResult"</span><span class="p">,</span>
</span><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="hll"><span class="w">            </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CleaningFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">MaintenanceFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
</span><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeFeedback</span><span class="p">(</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningFeedback</span><span class="p">,</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li><code>@ParallelAgent</code> makes both agents execute simultaneously</li>
<li>Both agents can read from and write to the shared <code>AgenticScope</code></li>
<li>Results are available to subsequent workflow steps</li>
</ul>
<h3 id="create-car-specialist-agents">Create Car Specialist Agents<a class="headerlink" href="#create-car-specialist-agents" title="Permanent link"></a></h3>
<p>These agents will examine the analysis results and determine what should happen to the car based on their specialty (either maintenance or cleaning)</p>
<h4 id="maintenanceagent">MaintenanceAgent<a class="headerlink" href="#maintenanceagent" title="Permanent link"></a></h4>
<p>Create <code>src/main/java/com/carmanagement/agentic/agents/MaintenanceAgent.java</code>:</p>
<div class="highlight"><span class="filename">MaintenanceAgent.java</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.tools.MaintenanceTool</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkiverse.langchain4j.ToolBox</span><span class="p">;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="cm">/**</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="cm"> * Agent that determines what maintenance services to request.</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="cm"> */</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MaintenanceAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="s">        You handle intake for the car maintenance department of a car rental company.</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="s">        It is your job to submit a request to the provided requestMaintenance function to take action on the maintenance request.</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="s">        Be specific about what services are needed based on the maintenance request.</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="s">        Available maintenance services include:</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="s">        - Oil change</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="s">        - Tire rotation</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="s">        - Brake service</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="s">        - Engine service</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="s">        - Transmission service</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="s">        - Body work (dent repair, paint, collision repair)</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="s">        For body damage like dents, scratches, or collision damage, request body work.</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="hll"><span class="s">        Car Information:</span>
</span><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="s">        Car Number: {carNumber}</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="s">        Maintenance Request:</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="s">        {maintenanceRequest}</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car maintenance specialist. Using car information and request, determines what maintenance services are needed."</span><span class="p">,</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">            </span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"analysisResult"</span><span class="p">)</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">    </span><span class="nd">@ToolBox</span><span class="p">(</span><span class="n">MaintenanceTool</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">processMaintenance</span><span class="p">(</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="p">}</span>
</code></pre></div>
<h4 id="update-cleaningagent">Update CleaningAgent<a class="headerlink" href="#update-cleaningagent" title="Permanent link"></a></h4>
<p>The CleaningAgent we created previously should now return analysisResult as well, so the results are aggregated.</p>
<p>Update <code>src/main/java/com/carmanagement/agentic/agents/CleaningAgent.java</code>:</p>
<div class="highlight"><span class="filename">CleaningAgent.java</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkiverse.langchain4j.ToolBox</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.tools.CleaningTool</span><span class="p">;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="cm">/**</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="cm"> * Agent that determines what cleaning services to request.</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="cm"> */</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CleaningAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="s">        You handle intake for the cleaning department of a car rental company.</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="s">        Taking into account all provided feedback, determine if the car needs a cleaning.</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="s">        If the feedback indicates the car is dirty, has stains, or any other cleanliness issues,</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="s">        call the provided tool and recommend appropriate cleaning services (exterior wash, interior cleaning, waxing, detailing).</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="s">        Be specific about what services are needed.</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="s">        If no specific cleaning request is provided, request a standard exterior wash.</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="s">        Car Information:</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="s">        Car Number: {carNumber}</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="s">        Cleaning Request:</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="s">        {cleaningRequest}</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Cleaning specialist. Determines what cleaning services are needed."</span><span class="p">,</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="hll"><span class="w">            </span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"analysisResult"</span><span class="p">)</span>
</span><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">    </span><span class="nd">@ToolBox</span><span class="p">(</span><span class="n">CleaningTool</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">processCleaning</span><span class="p">(</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">);</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="p">}</span>
</code></pre></div>
<h3 id="create-the-conditional-car-assignment-workflow">Create the Conditional Car Assignment Workflow<a class="headerlink" href="#create-the-conditional-car-assignment-workflow" title="Permanent link"></a></h3>
<p>The Car Assignment workflow is the conditional workflow which will active the appropriate
service agent path based on the analysis results. Notice the same analysisResult from the previous 2 agents we created.</p>
<p>Create <code>src/main/java/com/carmanagement/agentic/workflow/CarAssignmentWorkflow.java</code>:</p>
<div class="highlight"><span class="filename">CarAssignmentWorkflow.java</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow</span><span class="p">;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.CleaningAgent</span><span class="p">;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.MaintenanceAgent</span><span class="p">;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.ActivationCondition</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.ConditionalAgent</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="cm">/**</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="cm"> * Workflow for assigning cars to appropriate teams based on feedback analysis.</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="cm"> */</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CarAssignmentWorkflow</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="cm">     * Assigns the car to the appropriate team based on the feedback analysis.</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="cm">     */</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="hll"><span class="w">    </span><span class="nd">@ConditionalAgent</span><span class="p">(</span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"analysisResult"</span><span class="p">,</span>
</span><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="hll"><span class="w">            </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w">  </span><span class="n">CleaningAgent</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
</span><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">processAction</span><span class="p">(</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">,</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="hll"><span class="w">    </span><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">assignToMaintenance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="hll"><span class="w">    </span><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">CleaningAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">assignToCleaning</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">cleaningRequest</span><span class="p">);</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">"NOT_REQUIRED"</span><span class="p">);</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li><code>@ConditionalAgent</code> evaluates conditions to determine which agent runs</li>
<li><code>@ActivationCondition</code> methods return <code>true</code> to activate an agent</li>
<li>Maintenance has priority (checked first)</li>
<li>Cleaning only runs if maintenance is not needed</li>
</ul>
<h3 id="update-carconditionfeedbackagent">Update CarConditionFeedbackAgent<a class="headerlink" href="#update-carconditionfeedbackagent" title="Permanent link"></a></h3>
<p>Update <code>src/main/java/com/carmanagement/agentic/agents/CarConditionFeedbackAgent.java</code> to add the new maintenance recommendations:</p>
<div class="highlight"><span class="filename">CarConditionFeedbackAgent.java</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="cm">/**</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="cm"> * Agent that analyzes feedback to update the car condition.</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="cm"> */</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CarConditionFeedbackAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""       </span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="s">        You are a car condition analyzer for a car rental company. Your job is to determine the current condition of a car based on feedback.</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="s">        Analyze all feedback and the previous car condition to provide an updated condition description.</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="s">        Always provide a very short (no more than 200 characters) condition description, even if there's minimal feedback.</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="s">        Do not add any headers or prefixes to your response.</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="s">            Car Information:</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="s">            Make: {carMake}</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="s">            Model: {carModel}</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="s">            Year: {carYear}</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="s">            Previous Condition: {carCondition}</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="s">            Feedback from other agents:</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="s">            Cleaning Recommendation: {cleaningRequest}</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="hll"><span class="s">            Maintenance Recommendation: {maintenanceRequest}</span>
</span><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="s">            """</span><span class="p">)</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car condition analyzer. Determines the current condition of a car based on feedback."</span><span class="p">,</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">            </span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carCondition"</span><span class="p">)</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeForCondition</span><span class="p">(</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">,</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="hll"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
</span><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="p">}</span>
</code></pre></div>
<h3 id="create-supporting-infrastructure">Create Supporting Infrastructure<a class="headerlink" href="#create-supporting-infrastructure" title="Permanent link"></a></h3>
<h4 id="create-a-maintenance-tool-for-function-calling">Create a Maintenance Tool for function calling<a class="headerlink" href="#create-a-maintenance-tool-for-function-calling" title="Permanent link"></a></h4>
<p>Create <code>src/main/java/com/carmanagement/agentic/tools/MaintenanceTool.java</code> to add a function for creating a request to the maintenance team:</p>
<div class="highlight"><span class="filename">MaintenanceTool.java</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.tools</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agent.tool.Tool</span><span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.logging.Log</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="cm">/**</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="cm"> * Tool for requesting car maintenance operations.</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="cm"> */</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MaintenanceTool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="cm">     * Requests maintenance for a car based on the provided parameters.</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="cm">     *</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="cm">     * @param carNumber The car number</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="cm">     * @param carMake The car make</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="cm">     * @param carModel The car model</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="cm">     * @param carYear The car year</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="cm">     * @param oilChange Whether to request an oil change</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="cm">     * @param tireRotation Whether to request tire rotation</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="cm">     * @param brakeService Whether to request brake service</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="cm">     * @param engineService Whether to request engine service</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="cm">     * @param transmissionService Whether to request transmission service</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="cm">     * @param bodyWork Whether to request body work (dent repair, paint, collision repair)</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="cm">     * @param requestText The maintenance request text</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="cm">     * @return A summary of the maintenance request</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="cm">     */</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">    </span><span class="nd">@Tool</span><span class="p">(</span><span class="s">"Requests maintenance with the specified options including body work for dents, paint, and collision repairs"</span><span class="p">)</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">requestMaintenance</span><span class="p">(</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">oilChange</span><span class="p">,</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tireRotation</span><span class="p">,</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">brakeService</span><span class="p">,</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">engineService</span><span class="p">,</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">transmissionService</span><span class="p">,</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">bodyWork</span><span class="p">,</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">requestText</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="w">        </span><span class="c1">// In a more elaborate implementation, we might make an API call to a maintenance service here</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="w">        </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"Maintenance requested for "</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">carMake</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="w">               </span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">carModel</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">" ("</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">carYear</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">"), Car #"</span><span class="p">)</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="w">               </span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">carNumber</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">":\n"</span><span class="p">);</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oilChange</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Oil change\n"</span><span class="p">);</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>
<a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tireRotation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Tire rotation\n"</span><span class="p">);</span>
<a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>
<a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">brakeService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Brake service\n"</span><span class="p">);</span>
<a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>
<a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">engineService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Engine service\n"</span><span class="p">);</span>
<a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>
<a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">transmissionService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Transmission service\n"</span><span class="p">);</span>
<a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a>
<a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bodyWork</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Body work (dent repair, paint, collision repair)\n"</span><span class="p">);</span>
<a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a>
<a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestText</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">requestText</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"Additional notes: "</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">requestText</span><span class="p">);</span>
<a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>
<a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"  └─ MaintenanceAgent activated"</span><span class="p">);</span>
<a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">"🚗 MaintenanceTool result: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a><span class="p">}</span>
</code></pre></div>
<h4 id="create-carassignment-model">Create CarAssignment Model<a class="headerlink" href="#create-carassignment-model" title="Permanent link"></a></h4>
<p>Create <code>src/main/java/com/carmanagement/model/CarAssignment.java</code>:</p>
<div class="highlight"><span class="filename">CarAssignment.java</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.model</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="cm">/**</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="cm"> * Enum representing the type of possible car assignments for car processing</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="cm"> */</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">CarAssignment</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="n">MAINTENANCE</span><span class="p">,</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="n">CLEANING</span><span class="p">,</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="n">NONE</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="p">}</span>
</code></pre></div>
<h4 id="update-carconditions-model">Update CarConditions Model<a class="headerlink" href="#update-carconditions-model" title="Permanent link"></a></h4>
<p>Update <code>src/main/java/com/carmanagement/model/CarConditions.java</code>:</p>
<div class="highlight"><span class="filename">CarConditions.java</span><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.model</span><span class="p">;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="cm">/**</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="cm"> * Record representing the conditions of a car.</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="cm"> *</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="cm"> * @param generalCondition   A description of the car's general condition</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="cm"> * @param carAssignment    Indicates the action required</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="cm"> */</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CarConditions</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">generalCondition</span><span class="p">,</span><span class="w"> </span><span class="n">CarAssignment</span><span class="w"> </span><span class="n">carAssignment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="p">}</span>
</code></pre></div>
<h4 id="update-the-main-car-processing-workflow">Update the main Car Processing Workflow<a class="headerlink" href="#update-the-main-car-processing-workflow" title="Permanent link"></a></h4>
<p>Now it’s finally time to compose the sub workflows in the main Car Processing workflow!
We need to replace the direct call to the CleaningAgent with the FeedbackWorkflow that will analyze the feedback from the intake,
and then the CarAssignmentWorkflow to actually assign the car to the appropriate team based on the analysis.</p>
<p>We’ll also update the outputKey and the output method to make sure the assignment happens with the right priority.</p>
<p>Update <code>src/main/java/com/carmanagement/agentic/workflow/CarProcessingWorkflow.java</code>:</p>
<div class="highlight"><span class="filename">CarProcessingWorkflow.java</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.CarConditionFeedbackAgent</span><span class="p">;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarConditions</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarAssignment</span><span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.Output</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.SequenceAgent</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="cm">/**</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="cm"> * Workflow for processing car returns using a sequence of agents.</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="cm"> */</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CarProcessingWorkflow</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="cm">     * Processes a car return by running feedback analysis and then appropriate actions.</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="cm">     */</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="hll"><span class="w">    </span><span class="nd">@SequenceAgent</span><span class="p">(</span><span class="n">outputKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">,</span>
</span><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="hll"><span class="w">            </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FeedbackWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">CarAssignmentWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">CarConditionFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
</span><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">    </span><span class="n">CarConditions</span><span class="w"> </span><span class="nf">processCarReturn</span><span class="p">(</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningFeedback</span><span class="p">,</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="hll"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
</span><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">    </span><span class="nd">@Output</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="hll"><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">CarConditions</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="hll"><span class="w">        </span><span class="n">CarAssignment</span><span class="w"> </span><span class="n">carAssignment</span><span class="p">;</span>
</span><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="hll"><span class="w">        </span><span class="c1">// Check maintenance first (higher priority)</span>
</span><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="hll"><span class="w">            </span><span class="n">carAssignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarAssignment</span><span class="p">.</span><span class="na">MAINTENANCE</span><span class="p">;</span>
</span><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="hll"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRequired</span><span class="p">(</span><span class="n">cleaningRequest</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="hll"><span class="w">            </span><span class="n">carAssignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarAssignment</span><span class="p">.</span><span class="na">CLEANING</span><span class="p">;</span>
</span><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="hll"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="hll"><span class="w">            </span><span class="n">carAssignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarAssignment</span><span class="p">.</span><span class="na">NONE</span><span class="p">;</span>
</span><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="hll"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CarConditions</span><span class="p">(</span><span class="n">carCondition</span><span class="p">,</span><span class="w"> </span><span class="n">carAssignment</span><span class="p">);</span>
</span><a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a><span class="hll"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a><span class="hll"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">"NOT_REQUIRED"</span><span class="p">);</span>
</span><a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li><code>@SequenceAgent</code> runs the workflows and agents in order</li>
<li>Sub-agents can be <strong>other workflows</strong> (FeedbackWorkflow, CarAssignmentWorkflow)</li>
<li>All agents share the same <code>AgenticScope</code></li>
<li>The <code>@Output</code> method retrieves the maintenanceRequest and cleaningRequest from the AgenticScope
to determine what needs to happen next, and then returns this result.</li>
</ul>
<h4 id="update-the-service-layer">Update the Service Layer<a class="headerlink" href="#update-the-service-layer" title="Permanent link"></a></h4>
<p>And finally, we’ll update the Car Management service to handle the result from the Agentic AI workflow and update the system accordingly.
Update <code>src/main/java/com/carmanagement/service/CarManagementService.java</code>:</p>
<div class="highlight"><span class="filename">CarManagementService.java</span><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.service</span><span class="p">;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow.CarProcessingWorkflow</span><span class="p">;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarConditions</span><span class="p">;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarInfo</span><span class="p">;</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarStatus</span><span class="p">;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.logging.Log</span><span class="p">;</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="cm">/**</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="cm"> * Service for managing car returns from various operations.</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="cm"> */</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CarManagementService</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">    </span><span class="nd">@Inject</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">    </span><span class="n">CarProcessingWorkflow</span><span class="w"> </span><span class="n">carProcessingWorkflow</span><span class="p">;</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="cm">     * Process a car return from any operation.</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="cm">     *</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="cm">     * @param carNumber The car number</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="cm">     * @param rentalFeedback Optional rental feedback</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="cm">     * @param cleaningFeedback Optional cleaning feedback</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="cm">     * @param maintenanceFeedback Optional maintenance feedback</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="cm">     * @return Result of the processing</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="cm">     */</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="w">    </span><span class="nd">@Transactional</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">processCarReturn</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cleaningFeedback</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="w">        </span><span class="n">CarInfo</span><span class="w"> </span><span class="n">carInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarInfo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">carNumber</span><span class="p">);</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">"Car not found with number: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carNumber</span><span class="p">;</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"FeedbackWorkflow executing..."</span><span class="p">);</span>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"  ├─ CleaningFeedbackAgent analyzing..."</span><span class="p">);</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"  └─ MaintenanceFeedbackAgent analyzing..."</span><span class="p">);</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"CarAssignmentWorkflow evaluating conditions..."</span><span class="p">);</span>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="w">        </span><span class="c1">// Process the car return using the workflow and get the AgenticScope</span>
<a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="w">        </span><span class="n">CarConditions</span><span class="w"> </span><span class="n">carConditions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carProcessingWorkflow</span><span class="p">.</span><span class="na">processCarReturn</span><span class="p">(</span>
<a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">make</span><span class="p">,</span>
<a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">model</span><span class="p">,</span>
<a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">year</span><span class="p">,</span>
<a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="w">                </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">condition</span><span class="p">,</span>
<a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="w">                </span><span class="n">rentalFeedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="w">                </span><span class="n">cleaningFeedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">cleaningFeedback</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a><span class="w">                </span><span class="n">maintenanceFeedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">""</span><span class="p">);</span>
<a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a>
<a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"CarConditionFeedbackAgent updating..."</span><span class="p">);</span>
<a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a>
<a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="w">        </span><span class="c1">// Update the car's condition with the result from CarConditionFeedbackAgent</span>
<a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a><span class="w">        </span><span class="n">carInfo</span><span class="p">.</span><span class="na">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carConditions</span><span class="p">.</span><span class="na">generalCondition</span><span class="p">();</span>
<a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a>
<a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a><span class="w">        </span><span class="c1">// Update the car status based on the required action</span>
<a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">carConditions</span><span class="p">.</span><span class="na">carAssignment</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MAINTENANCE</span><span class="p">:</span>
<a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarStatus</span><span class="p">.</span><span class="na">IN_MAINTENANCE</span><span class="p">;</span>
<a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">CLEANING</span><span class="p">:</span>
<a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarStatus</span><span class="p">.</span><span class="na">AT_CLEANING</span><span class="p">;</span>
<a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">NONE</span><span class="p">:</span>
<a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarStatus</span><span class="p">.</span><span class="na">AVAILABLE</span><span class="p">;</span>
<a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a>
<a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a><span class="w">        </span><span class="c1">// Persist the changes to the database</span>
<a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="w">        </span><span class="n">carInfo</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
<a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a>
<a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">carConditions</span><span class="p">.</span><span class="na">generalCondition</span><span class="p">();</span>
<a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a><span class="p">}</span>
</code></pre></div>
<h3 id="test-your-implementation">Test Your Implementation<a class="headerlink" href="#test-your-implementation" title="Permanent link"></a></h3>
<p>Once you’ve implemented all the parts:</p>
<ol>
<li>
<p>Start your application:
</p><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>./mvnw<span class="w"> </span>quarkus:dev
</code></pre></div>
</li>
<li>
<p>Open <a href="http://localhost:8080" target="_blank">http://localhost:8080</a></p>
</li>
<li>
<p>Test with the scenarios described earlier</p>
</li>
<li>
<p>Compare your implementation with the complete solution in <code>section-2/step-03</code></p>
</li>
</ol>
<hr>
<h2 id="experiment-further">Experiment Further<a class="headerlink" href="#experiment-further" title="Permanent link"></a></h2>
<h3 id="1-add-priority-levels">1. Add Priority Levels<a class="headerlink" href="#1-add-priority-levels" title="Permanent link"></a></h3>
<p>What if you wanted to add a third level of priority (e.g., emergency repairs)?</p>
<ul>
<li>Add an <code>EmergencyRepairFeedbackAgent</code></li>
<li>Update <code>CarAssignmentWorkflow</code> with a third condition</li>
<li>Ensure emergency repairs take highest priority</li>
</ul>
<h3 id="2-make-feedback-analysis-sequential">2. Make Feedback Analysis Sequential<a class="headerlink" href="#2-make-feedback-analysis-sequential" title="Permanent link"></a></h3>
<p>Try changing <code>FeedbackWorkflow</code> from <code>@ParallelAgent</code> to <code>@SequenceAgent</code>. How does this affect performance? When might you want sequential analysis?</p>
<h3 id="3-add-more-sophisticated-conditions">3. Add More Sophisticated Conditions<a class="headerlink" href="#3-add-more-sophisticated-conditions" title="Permanent link"></a></h3>
<p>The <code>CarAssignmentWorkflow</code> currently uses simple <code>isRequired()</code> checks. Try adding:</p>
<ul>
<li>Cost-based conditions (only send to maintenance if estimated cost &lt; $500)</li>
<li>Time-based conditions (skip cleaning if it was cleaned in last 24 hours)</li>
<li>Severity-based conditions (emergency repairs vs. routine maintenance)</li>
</ul>
<h3 id="4-visualize-the-workflow">4. Visualize the Workflow<a class="headerlink" href="#4-visualize-the-workflow" title="Permanent link"></a></h3>
<p>Add logging to each agent and workflow to print when they start and finish. Observe the parallel execution in the logs!</p>
<hr>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link"></a></h2>
<details class="warning">
<summary>Parallel agents not executing in parallel</summary>
<p>Check that your system has multiple CPU cores and that the thread pool is configured properly. In development mode, Quarkus should handle this automatically.</p>
</details>
<details class="warning">
<summary>Conditional workflow always/never executing certain agents</summary>
<ul>
<li>Verify your <code>@ActivationCondition</code> methods are correctly named</li>
<li>Check that parameter names match the <code>outputKey</code> values exactly</li>
<li>Add logging to the condition methods to see what values they’re receiving</li>
</ul>
</details>
<details class="warning">
<summary>Error: Cannot find symbol ‘CarAssignment’</summary>
<p>Make sure you created both:</p>
<ul>
<li>The <code>CarAssignment</code> enum</li>
<li>Updated <code>CarConditions</code> to use it</li>
</ul>
</details>
<details class="warning">
<summary>Agents getting wrong input values</summary>
<p>Remember that parameter names must match the <code>outputKey</code> from previous agents or workflow inputs. Check for typos!</p>
</details>
<hr>
<h2 id="whats-next">What’s Next?<a class="headerlink" href="#whats-next" title="Permanent link"></a></h2>
<p>You’ve built a sophisticated multi-level nested workflow combining sequence, parallel, and conditional execution!</p>
<p>In <strong>Step 04</strong>, you’ll learn about <strong>Agent-to-Agent (A2A) communication</strong> — connecting your workflows to remote agents running in separate systems!</p>
<p><a href="../step-04/">Continue to Step 04 - Using Remote Agents (A2A)</a></p></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../step-02/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Step 2 - Creating simple agentic workflows">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Step 2 - Creating simple agentic workflows
              </div>
            </div>
          </a>
        
        
          
          <a href="../step-04/" class="md-footer__link md-footer__link--next" aria-label="Next: Step 4 - Supervisor pattern for dynamic orchestration">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Step 4 - Supervisor pattern for dynamic orchestration
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!--
  Copyright (c) 2016-2022 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Copyright and theme information, adapter to have the Red Hat footer -->
<div class="md-copyright">
    <div class="md-copyright__highlight">
        <a href="https://creativecommons.org/licenses/by/3.0/">CC by 3.0</a> |
        <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </div>
    
    Made with
    <a
            href="https://squidfunk.github.io/mkdocs-material/"
            target="_blank" rel="noopener"
    >
        Material for MkDocs
    </a>
    
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "content.tabs.link", "content.code.annotate", "navigation.instant", "navigation.indexes", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky", "content.code.select", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../assets/javascripts/panzoom.min.js"></script>
      
        <script src="../../assets/javascripts/zoompan.js"></script>
      
    
  </body>
</html>