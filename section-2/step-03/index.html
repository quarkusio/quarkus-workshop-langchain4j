
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../step-02/">
      
      
        <link rel="next" href="../step-04/">
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Step 3 - Building nested agent workflows - Quarkus LangChain4j Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-03-building-nested-agent-workflows" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You are not viewing the latest version.
<a href="../../..">
    <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Quarkus LangChain4j Workshop" class="md-header__button md-logo" aria-label="Quarkus LangChain4j Workshop" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Quarkus LangChain4j Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Step 3 - Building nested agent workflows
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H6zm7-4.68V17c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-2.26C3.19 13.47 2 11.38 2 9c0-3.87 3.13-7 7-7 1.65 0 3.16.57 4.35 1.5C10.8 4.57 9 7.07 9 10c0 2.79 1.64 5.19 4 6.32m7.92-6.38-1.42-.91-1.4.97.4-1.65-1.33-1.03 1.68-.11.56-1.61.63 1.58 1.68.04-1.3 1.08zM19.39 13c-1.89 2.27-5.36 2.19-7.17-.05C10 10.13 11.56 6 15 5.34c.34-.05.64.29.5.63-.45 1.28-.38 2.74.35 4a4.62 4.62 0 0 0 3.27 2.28c.35.05.5.49.27.75"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 6a6 6 0 0 1 6 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1.8c-1.79-1.04-3-2.98-3-5.2a6 6 0 0 1 6-6m2 15v1a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1zm6-10h3v2h-3zM1 11h3v2H1zM13 1v3h-2V1zM4.92 3.5l2.13 2.14-1.42 1.41L3.5 4.93zm12.03 2.13 2.12-2.13 1.43 1.43-2.13 2.12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/quarkusio/quarkus-langchain4j-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Quarkus LangChain4j Workshop" class="md-nav__button md-logo" aria-label="Quarkus LangChain4j Workshop" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Quarkus LangChain4j Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/quarkusio/quarkus-langchain4j-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Requirements
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Section 1 - AI Apps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Section 1 - AI Apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 1 - Introduction to Quarkus LangChain4j
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 2 - Playing with model parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 3 - Streaming responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 4 - Using system messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 5 - Introduction to the RAG pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-06/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 6 - Deconstructing the RAG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-07/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 7 - Function calling and tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 8 - Model Context Protocol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 9 - Guardrails
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../section-1/step-10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 10 - Observability and Fault Tolerance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Section 2 - Agentic Workflows
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Section 2 - Agentic Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 1 - Implementing AI Agents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 2 - Composing simple agent workflows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Step 3 - Building nested agent workflows
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Step 3 - Building nested agent workflows
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#new-requirement-comprehensive-car-management" class="md-nav__link">
    <span class="md-ellipsis">
      New Requirement: Comprehensive Car Management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-learn" class="md-nav__link">
    <span class="md-ellipsis">
      What You&rsquo;ll Learn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-nested-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Nested Workflows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-we-going-to-build" class="md-nav__link">
    <span class="md-ellipsis">
      What Are We Going to Build?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-nested-workflow-structure" class="md-nav__link">
    <span class="md-ellipsis">
      The Nested Workflow Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#option-1-continue-from-step-02" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Continue from Step 02
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#option-2-start-fresh-from-step-03" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: Start Fresh from Step 03
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-create-feedback-analysis-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Part 1: Create Feedback Analysis Agents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: Create Feedback Analysis Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-maintenancefeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create the MaintenanceFeedbackAgent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-carwashfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create the CarWashFeedbackAgent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-create-the-parallel-feedback-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Create the Parallel Feedback Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Create the Parallel Feedback Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-create-the-feedbackworkflow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Create the FeedbackWorkflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Create the FeedbackWorkflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallelagent-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      @ParallelAgent Annotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-create-action-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Part 3: Create Action Agents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: Create Action Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-maintenanceagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Create the MaintenanceAgent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-update-the-carwashagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Update the CarWashAgent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-create-the-conditional-action-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Part 4: Create the Conditional Action Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 4: Create the Conditional Action Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-6-create-the-actionworkflow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Create the ActionWorkflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Create the ActionWorkflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditionalagent-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      @ConditionalAgent Annotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activationcondition-methods" class="md-nav__link">
    <span class="md-ellipsis">
      @ActivationCondition Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Logic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-update-the-car-condition-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Part 5: Update the Car Condition Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 5: Update the Car Condition Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-7-update-carconditionfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 7: Update CarConditionFeedbackAgent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6-create-supporting-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Part 6: Create Supporting Infrastructure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 6: Create Supporting Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-8-create-the-maintenancetool" class="md-nav__link">
    <span class="md-ellipsis">
      Step 8: Create the MaintenanceTool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-9-create-the-requiredaction-model" class="md-nav__link">
    <span class="md-ellipsis">
      Step 9: Create the RequiredAction Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-10-update-the-carconditions-model" class="md-nav__link">
    <span class="md-ellipsis">
      Step 10: Update the CarConditions Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-11-add-maintenance-returns-api" class="md-nav__link">
    <span class="md-ellipsis">
      Step 11: Add Maintenance Returns API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-7-update-the-main-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Part 7: Update the Main Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 7: Update the Main Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-12-update-carprocessingworkflow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 12: Update CarProcessingWorkflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 12: Update CarProcessingWorkflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      The Sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-execution-order" class="md-nav__link">
    <span class="md-ellipsis">
      The Execution Order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-output-method" class="md-nav__link">
    <span class="md-ellipsis">
      The @Output Method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-8-update-the-service-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Part 8: Update the Service Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 8: Update the Service Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-13-update-carmanagementservice" class="md-nav__link">
    <span class="md-ellipsis">
      Step 13: Update CarManagementService
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-out" class="md-nav__link">
    <span class="md-ellipsis">
      Try It Out
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Try It Out">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notice-the-new-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Notice the New UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-complete-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Test the Complete Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Check the Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-all-works-together" class="md-nav__link">
    <span class="md-ellipsis">
      How It All Works Together
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It All Works Together">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-strange-engine-noise" class="md-nav__link">
    <span class="md-ellipsis">
      Example: &ldquo;Strange engine noise&rdquo;
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-workflow-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Workflow Composition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Workflow Composition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Building Blocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composition-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      Composition Hierarchy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-further" class="md-nav__link">
    <span class="md-ellipsis">
      Experiment Further
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Experiment Further">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-add-priority-levels" class="md-nav__link">
    <span class="md-ellipsis">
      1. Add Priority Levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-make-feedback-analysis-sequential" class="md-nav__link">
    <span class="md-ellipsis">
      2. Make Feedback Analysis Sequential
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-more-sophisticated-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      3. Add More Sophisticated Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-visualize-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      4. Visualize the Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What&rsquo;s Next?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../step-04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Step 4 - Using remote agents (A2A)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mastering Agentic Systems
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../conclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conclusion
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#new-requirement-comprehensive-car-management" class="md-nav__link">
    <span class="md-ellipsis">
      New Requirement: Comprehensive Car Management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-learn" class="md-nav__link">
    <span class="md-ellipsis">
      What You&rsquo;ll Learn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-nested-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Nested Workflows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-we-going-to-build" class="md-nav__link">
    <span class="md-ellipsis">
      What Are We Going to Build?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-nested-workflow-structure" class="md-nav__link">
    <span class="md-ellipsis">
      The Nested Workflow Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#option-1-continue-from-step-02" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Continue from Step 02
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#option-2-start-fresh-from-step-03" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: Start Fresh from Step 03
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-create-feedback-analysis-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Part 1: Create Feedback Analysis Agents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: Create Feedback Analysis Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-maintenancefeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create the MaintenanceFeedbackAgent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-carwashfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create the CarWashFeedbackAgent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-create-the-parallel-feedback-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Create the Parallel Feedback Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Create the Parallel Feedback Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-create-the-feedbackworkflow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Create the FeedbackWorkflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Create the FeedbackWorkflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallelagent-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      @ParallelAgent Annotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-create-action-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Part 3: Create Action Agents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: Create Action Agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-maintenanceagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Create the MaintenanceAgent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-update-the-carwashagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Update the CarWashAgent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-create-the-conditional-action-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Part 4: Create the Conditional Action Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 4: Create the Conditional Action Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-6-create-the-actionworkflow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Create the ActionWorkflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Create the ActionWorkflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditionalagent-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      @ConditionalAgent Annotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activationcondition-methods" class="md-nav__link">
    <span class="md-ellipsis">
      @ActivationCondition Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Logic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-update-the-car-condition-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Part 5: Update the Car Condition Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 5: Update the Car Condition Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-7-update-carconditionfeedbackagent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 7: Update CarConditionFeedbackAgent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6-create-supporting-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Part 6: Create Supporting Infrastructure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 6: Create Supporting Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-8-create-the-maintenancetool" class="md-nav__link">
    <span class="md-ellipsis">
      Step 8: Create the MaintenanceTool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-9-create-the-requiredaction-model" class="md-nav__link">
    <span class="md-ellipsis">
      Step 9: Create the RequiredAction Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-10-update-the-carconditions-model" class="md-nav__link">
    <span class="md-ellipsis">
      Step 10: Update the CarConditions Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-11-add-maintenance-returns-api" class="md-nav__link">
    <span class="md-ellipsis">
      Step 11: Add Maintenance Returns API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-7-update-the-main-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Part 7: Update the Main Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 7: Update the Main Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-12-update-carprocessingworkflow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 12: Update CarProcessingWorkflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 12: Update CarProcessingWorkflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      The Sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-execution-order" class="md-nav__link">
    <span class="md-ellipsis">
      The Execution Order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-output-method" class="md-nav__link">
    <span class="md-ellipsis">
      The @Output Method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-8-update-the-service-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Part 8: Update the Service Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 8: Update the Service Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-13-update-carmanagementservice" class="md-nav__link">
    <span class="md-ellipsis">
      Step 13: Update CarManagementService
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-out" class="md-nav__link">
    <span class="md-ellipsis">
      Try It Out
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Try It Out">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notice-the-new-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Notice the New UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-complete-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Test the Complete Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Check the Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-all-works-together" class="md-nav__link">
    <span class="md-ellipsis">
      How It All Works Together
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It All Works Together">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-strange-engine-noise" class="md-nav__link">
    <span class="md-ellipsis">
      Example: &ldquo;Strange engine noise&rdquo;
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-workflow-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Workflow Composition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Workflow Composition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Building Blocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composition-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      Composition Hierarchy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-further" class="md-nav__link">
    <span class="md-ellipsis">
      Experiment Further
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Experiment Further">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-add-priority-levels" class="md-nav__link">
    <span class="md-ellipsis">
      1. Add Priority Levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-make-feedback-analysis-sequential" class="md-nav__link">
    <span class="md-ellipsis">
      2. Make Feedback Analysis Sequential
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-more-sophisticated-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      3. Add More Sophisticated Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-visualize-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      4. Visualize the Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What&rsquo;s Next?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div><h1 id="step-03-building-nested-agent-workflows">Step 03 - Building Nested Agent Workflows<a class="headerlink" href="#step-03-building-nested-agent-workflows" title="Permanent link"></a></h1>
<h2 id="new-requirement-comprehensive-car-management">New Requirement: Comprehensive Car Management<a class="headerlink" href="#new-requirement-comprehensive-car-management" title="Permanent link"></a></h2>
<p>The Miles of Smiles management team wants (again!) a more sophisticated car management system.
When cars are returned, the system should automatically:</p>
<ol>
<li><strong>Analyze feedback</strong> for both cleaning needs AND maintenance requirements</li>
<li><strong>Route cars appropriately</strong> — send to maintenance if needed, otherwise to car wash if needed</li>
<li><strong>Track all feedback sources</strong> — from rentals, car wash, and maintenance teams</li>
<li><strong>Update car conditions</strong> based on all collected feedback</li>
</ol>
<p>This requires a more complex workflow that can handle <strong>parallel analysis</strong> and <strong>conditional routing</strong>.</p>
<hr>
<h2 id="what-youll-learn">What You’ll Learn<a class="headerlink" href="#what-youll-learn" title="Permanent link"></a></h2>
<p>In this step, you will:</p>
<ul>
<li>Build <strong>nested workflows</strong>, workflows that contain other workflows</li>
<li>Use <strong>parallel workflows</strong> to run multiple agents concurrently</li>
<li>Implement <strong>conditional workflows</strong> that route execution based on conditions</li>
<li>Understand <strong>activation conditions</strong> that control when agents execute</li>
<li>See how complex agent systems compose from simple building blocks</li>
</ul>
<hr>
<h2 id="understanding-nested-workflows">Understanding Nested Workflows<a class="headerlink" href="#understanding-nested-workflows" title="Permanent link"></a></h2>
<p>In Step 02, you built a simple sequence workflow with two agents running one after another. In this step, you’ll build a three-level nested workflow:</p>
<pre class="mermaid"><code>graph TD
    A[CarProcessingWorkflow&lt;br/&gt;Sequence] --&gt; B[1. FeedbackWorkflow&lt;br/&gt;Parallel]
    A --&gt; C[2. ActionWorkflow&lt;br/&gt;Conditional]
    A --&gt; D[3. CarConditionFeedbackAgent&lt;br/&gt;Single Agent]

    B --&gt; B1[CarWashFeedbackAgent]
    B --&gt; B2[MaintenanceFeedbackAgent]

    C --&gt; C1{Condition:&lt;br/&gt;Maintenance needed?}
    C1 --&gt;|Yes| C2[MaintenanceAgent]
    C1 --&gt;|No| C3{Condition:&lt;br/&gt;Car wash needed?}
    C3 --&gt;|Yes| C4[CarWashAgent]
    C3 --&gt;|No| C5[Skip]</code></pre>
<p><strong>The Flow:</strong></p>
<ol>
<li><strong>FeedbackWorkflow</strong> (Parallel): Analyzes feedback simultaneously from two perspectives:</li>
<li>Does the car need maintenance?</li>
<li>
<p>Does the car need washing?</p>
</li>
<li>
<p><strong>ActionWorkflow</strong> (Conditional): Routes the car based on the analysis:</p>
</li>
<li>If maintenance needed → send to maintenance team</li>
<li>Else if washing needed → send to car wash</li>
<li>
<p>Else → do nothing</p>
</li>
<li>
<p><strong>CarConditionFeedbackAgent</strong> (Single): Updates the car’s condition based on all feedback</p>
</li>
</ol>
<hr>
<h2 id="what-are-we-going-to-build">What Are We Going to Build?<a class="headerlink" href="#what-are-we-going-to-build" title="Permanent link"></a></h2>
<p><img alt="App Blueprint" class="center" src="../../images/agentic-app-3.png"></p>
<p>We’ll transform the car management system to handle:</p>
<ul>
<li><strong>Three feedback sources</strong>: rental returns, car wash returns, maintenance returns</li>
<li><strong>Parallel analysis</strong>: concurrent evaluation for cleaning and maintenance needs</li>
<li><strong>Conditional routing</strong>: intelligent decision-making about where to send each car</li>
<li><strong>Comprehensive tracking</strong>: updated car conditions based on all feedback</li>
</ul>
<hr>
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link"></a></h2>
<h3 id="the-nested-workflow-structure">The Nested Workflow Structure<a class="headerlink" href="#the-nested-workflow-structure" title="Permanent link"></a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant Main as CarProcessingWorkflow&lt;br/&gt;(Sequence)
    participant Feedback as FeedbackWorkflow&lt;br/&gt;(Parallel)
    participant Action as ActionWorkflow&lt;br/&gt;(Conditional)
    participant Condition as CarConditionFeedbackAgent
    participant Scope as AgenticScope

    User-&gt;&gt;Main: processCarReturn(feedback)
    Main-&gt;&gt;Scope: Initialize state

    Note over Main,Feedback: Step 1: Parallel Analysis
    Main-&gt;&gt;Feedback: analyzeFeedback()
    par Parallel Execution
        Feedback-&gt;&gt;Scope: CarWashFeedbackAgent&lt;br/&gt;Write: carWashRequest
    and
        Feedback-&gt;&gt;Scope: MaintenanceFeedbackAgent&lt;br/&gt;Write: maintenanceRequest
    end

    Note over Main,Action: Step 2: Conditional Routing
    Main-&gt;&gt;Action: processAction()
    Action-&gt;&gt;Action: Check conditions
    alt Maintenance Required
        Action-&gt;&gt;Scope: MaintenanceAgent executes
    else Car Wash Required
        Action-&gt;&gt;Scope: CarWashAgent executes
    else Neither Required
        Action-&gt;&gt;Action: Skip both agents
    end

    Note over Main,Condition: Step 3: Update Condition
    Main-&gt;&gt;Condition: analyzeForCondition()
    Condition-&gt;&gt;Scope: Write: carCondition

    Main-&gt;&gt;User: Return CarConditions</code></pre>
<hr>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h2>
<p>Before starting:</p>
<ul>
<li>Completed Step 02 (or have the <code>section-2/step-02</code> code available)</li>
<li>Application from Step 02 is stopped (Ctrl+C)</li>
</ul>
<hr>
<h2 id="option-1-continue-from-step-02">Option 1: Continue from Step 02<a class="headerlink" href="#option-1-continue-from-step-02" title="Permanent link"></a></h2>
<p>If you want to continue building on your Step 02 code, copy the updated files:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">Linux / macOS</label><label for="__tabbed_1_2">Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>section-2/step-02
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>cp<span class="w"> </span>../step-03/src/main/resources/static/css/styles.css<span class="w"> </span>./src/main/resources/static/css/styles.css
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>cp<span class="w"> </span>../step-03/src/main/resources/static/js/app.js<span class="w"> </span>./src/main/resources/static/js/app.js
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>cp<span class="w"> </span>../step-03/src/main/resources/templates/index.html<span class="w"> </span>./src/main/resources/templates/index.html
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>cp<span class="w"> </span>../step-03/src/main/resources/import.sql<span class="w"> </span>./src/main/resources/import.sql
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>cp<span class="w"> </span>../step-03/src/main/java/com/carmanagement/model/CarStatus.java<span class="w"> </span>./src/main/java/com/carmanagement/model/CarStatus.java
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>cd section-2\step-02
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>copy ..\step-03\src\main\resources\static\css\styles.css .\src\main\resources\static\css\styles.css
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>copy ..\step-03\src\main\resources\static\js\app.js .\src\main\resources\static\js\app.js
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>copy ..\step-03\src\main\resources\templates\index.html .\src\main\resources\templates\index.html
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>copy ..\step-03\src\main\resources\import.sql .\src\main\resources\import.sql
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>copy ..\step-03\src\main\java\com\carmanagement\service\CarService.java .\src\main\java\com\carmanagement\service\CarService.java
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>copy ..\step-03\src\main\java\com\carmanagement\model\CarStatus.java .\src\main\java\com\carmanagement\model\CarStatus.java
</code></pre></div>
</div>
</div>
</div>
<hr>
<h2 id="option-2-start-fresh-from-step-03">Option 2: Start Fresh from Step 03<a class="headerlink" href="#option-2-start-fresh-from-step-03" title="Permanent link"></a></h2>
<p>Navigate to the complete <code>section-2/step-03</code> directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span>section-2/step-03
</code></pre></div>
<hr>
<h2 id="part-1-create-feedback-analysis-agents">Part 1: Create Feedback Analysis Agents<a class="headerlink" href="#part-1-create-feedback-analysis-agents" title="Permanent link"></a></h2>
<p>We need two specialized agents to analyze feedback from different perspectives.</p>
<h3 id="step-1-create-the-maintenancefeedbackagent">Step 1: Create the MaintenanceFeedbackAgent<a class="headerlink" href="#step-1-create-the-maintenancefeedbackagent" title="Permanent link"></a></h3>
<p>This agent determines if a car needs maintenance based on feedback.</p>
<p>In <code>src/main/java/com/carmanagement/agentic/agents</code>, create <code>MaintenanceFeedbackAgent.java</code>:</p>
<div class="highlight"><span class="filename">MaintenanceFeedbackAgent.java</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="cm">/**</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="cm"> * Agent that analyzes feedback to determine if maintenance is needed.</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="cm"> */</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="hll"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MaintenanceFeedbackAgent</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="hll"><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
</span><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="hll"><span class="s">        You are a car maintenance analyzer for a car rental company. Your job is to determine if a car needs maintenance based on feedback.</span>
</span><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="hll"><span class="s">        Analyze the feedback and car information to decide if maintenance is needed.</span>
</span><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="hll"><span class="s">        If the feedback mentions mechanical issues, strange noises, performance problems, or anything that suggests</span>
</span><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="hll"><span class="s">        the car needs maintenance, recommend appropriate maintenance.</span>
</span><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="hll"><span class="s">        Be specific about what type of maintenance is needed (oil change, tire rotation, brake service, engine service, transmission service).</span>
</span><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="hll"><span class="s">        If no service of any kind, repairs or maintenance are needed, respond with </span>
</span><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="hll"><span class="s">        "MAINTENANCE_NOT_REQUIRED".</span>
</span><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="hll"><span class="s">        Include the reason for your choice but keep your response short.</span>
</span><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="hll"><span class="s">        """</span><span class="p">)</span>
</span><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="s">        Car Information:</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="s">        Previous Condition: {carCondition}</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="s">        Feedback:</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="hll"><span class="s">        Rental Feedback: {rentalFeedback}</span>
</span><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="hll"><span class="s">        Car Wash Feedback: {carWashFeedback}</span>
</span><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="hll"><span class="s">        Maintenance Feedback: {maintenanceFeedback}</span>
</span><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car maintenance analyzer. Using feedback, determines if a car needs maintenance."</span><span class="p">,</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="hll"><span class="w">            </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"maintenanceRequest"</span><span class="p">)</span>
</span><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeForMaintenance</span><span class="p">(</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carWashFeedback</span><span class="p">,</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li><strong>System message</strong>: Focuses on mechanical issues, performance problems, and maintenance needs</li>
<li><strong>Specific output format</strong>: Returns “MAINTENANCE_NOT_REQUIRED” when no maintenance is needed (for easy conditional checking)</li>
<li><strong>outputName</strong>: <code>"maintenanceRequest"</code> — stores the result in AgenticScope’s state</li>
<li><strong>Three feedback sources</strong>: Analyzes rental, car wash, AND maintenance feedback</li>
</ul>
<h3 id="step-2-create-the-carwashfeedbackagent">Step 2: Create the CarWashFeedbackAgent<a class="headerlink" href="#step-2-create-the-carwashfeedbackagent" title="Permanent link"></a></h3>
<p>This agent determines if a car needs washing based on feedback.</p>
<p>In <code>src/main/java/com/carmanagement/agentic/agents</code>, create <code>CarWashFeedbackAgent.java</code>:</p>
<div class="highlight"><span class="filename">CarWashFeedbackAgent.java</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="cm">/**</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="cm"> * Agent that analyzes feedback to determine if a car wash is needed.</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="cm"> */</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CarWashFeedbackAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="s">        You are a car wash analyzer for a car rental company. Your job is to determine if a car needs washing based on feedback.</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="s">        Analyze the feedback and car information to decide if a car wash is needed.</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="s">        If the feedback mentions dirt, mud, stains, or anything that suggests the car is dirty, recommend a car wash.</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="s">        Be specific about what type of car wash is needed (exterior, interior, detailing, waxing).</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="s">        If no interior or exterior car cleaning services are needed based on the feedback, respond with "CARWASH_NOT_REQUIRED".</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="s">        Include the reason for your choice but keep your response short.</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="s">        Car Information:</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="s">        Previous Condition: {carCondition}</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="s">        Feedback:</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="s">        Rental Feedback: {rentalFeedback}</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="s">        Car Wash Feedback: {carWashFeedback}</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="s">        Maintenance Feedback: {maintenanceFeedback}</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car wash analyzer. Using feedback, determines if a car wash is needed."</span><span class="p">,</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">            </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carWashRequest"</span><span class="p">)</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeForCarWash</span><span class="p">(</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carWashFeedback</span><span class="p">,</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li><strong>System message</strong>: Focuses on cleanliness issues — dirt, stains, smells</li>
<li><strong>Specific output format</strong>: Returns “CARWASH_NOT_REQUIRED” when no washing is needed</li>
<li><strong>outputName</strong>: <code>"carWashRequest"</code> — stores the result in AgenticScope’s state</li>
<li><strong>Same inputs</strong>: Also analyzes all three feedback sources</li>
</ul>
<hr>
<h2 id="part-2-create-the-parallel-feedback-workflow">Part 2: Create the Parallel Feedback Workflow<a class="headerlink" href="#part-2-create-the-parallel-feedback-workflow" title="Permanent link"></a></h2>
<p>Now we’ll create a workflow that runs both feedback agents <strong>concurrently</strong>.</p>
<h3 id="step-3-create-the-feedbackworkflow">Step 3: Create the FeedbackWorkflow<a class="headerlink" href="#step-3-create-the-feedbackworkflow" title="Permanent link"></a></h3>
<p>In <code>src/main/java/com/carmanagement/agentic/workflow</code>, create <code>FeedbackWorkflow.java</code>:</p>
<div class="highlight"><span class="filename">FeedbackWorkflow.java</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.CarWashFeedbackAgent</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.MaintenanceFeedbackAgent</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.ParallelAgent</span><span class="p">;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.SubAgent</span><span class="p">;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="cm">/**</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="cm"> * Workflow for processing car feedback in parallel.</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="cm"> */</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">FeedbackWorkflow</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="cm">     * Runs multiple feedback agents in parallel to analyze different aspects of car feedback.</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="cm">     */</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"feedbackResult"</span><span class="p">)</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="nd">@ParallelAgent</span><span class="p">(</span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"feedbackResult"</span><span class="p">,</span><span class="w"> </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarWashFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carWashRequest"</span><span class="p">),</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaintenanceFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"maintenanceRequest"</span><span class="p">)</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">analyzeFeedback</span><span class="p">(</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carWashFeedback</span><span class="p">,</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Let’s break it down:</strong></p>
<h4 id="parallelagent-annotation"><code>@ParallelAgent</code> Annotation<a class="headerlink" href="#parallelagent-annotation" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nd">@ParallelAgent</span><span class="p">(</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"feedbackResult"</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarWashFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carWashRequest"</span><span class="p">),</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaintenanceFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"maintenanceRequest"</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">)</span>
</code></pre></div>
<p>This defines a <strong>parallel workflow</strong>:</p>
<ul>
<li>Both agents execute <strong>concurrently</strong></li>
<li>Improves performance, no waiting for one to finish before the other starts</li>
<li>Each agent has its own <code>outputName</code> to store results independently</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Why Parallel Here?</p>
<p>The two feedback agents analyze different aspects (cleaning vs. maintenance) and don’t depend on each other. 
Running them in parallel cuts the total execution time roughly in half!</p>
</div>
<hr>
<h2 id="part-3-create-action-agents">Part 3: Create Action Agents<a class="headerlink" href="#part-3-create-action-agents" title="Permanent link"></a></h2>
<p>We need agents that can actually request maintenance and car washes.</p>
<h3 id="step-4-create-the-maintenanceagent">Step 4: Create the MaintenanceAgent<a class="headerlink" href="#step-4-create-the-maintenanceagent" title="Permanent link"></a></h3>
<p>This agent uses a tool to request maintenance services.</p>
<p>In <code>src/main/java/com/carmanagement/agentic/agents</code>, create <code>MaintenanceAgent.java</code>:</p>
<div class="highlight"><span class="filename">MaintenanceAgent.java</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.tools.MaintenanceTool</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkiverse.langchain4j.ToolBox</span><span class="p">;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="cm">/**</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="cm"> * Agent that determines what maintenance services to request.</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="cm"> */</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MaintenanceAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="hll"><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
</span><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="hll"><span class="s">        You handle intake for the car maintenance department of a car rental company.</span>
</span><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="hll"><span class="s">        It is your job to submit a request to the provided requestMaintenance function to take action on the maintenance request.</span>
</span><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="hll"><span class="s">        Be specific about what services are needed based on the maintenance request.</span>
</span><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="hll"><span class="s">        """</span><span class="p">)</span>
</span><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="s">        Car Information:</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="s">        Car Number: {carNumber}</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="s">        Maintenance Request:</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="s">        {maintenanceRequest}</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car maintenance specialist. Using car information and request, determines what maintenance services are needed."</span><span class="p">,</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="w">            </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"maintenanceAgentResult"</span><span class="p">)</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="hll"><span class="w">    </span><span class="nd">@ToolBox</span><span class="p">(</span><span class="n">MaintenanceTool</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">processMaintenance</span><span class="p">(</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="hll"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
</span><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li><strong>Input</strong>: <code>maintenanceRequest</code> — reads the output from <code>MaintenanceFeedbackAgent</code></li>
<li><strong>Tool</strong>: <code>MaintenanceTool</code> — can request oil changes, brake service, etc.</li>
<li><strong>System message</strong>: Interprets the maintenance request and calls the appropriate tool</li>
</ul>
<h3 id="step-5-update-the-carwashagent">Step 5: Update the CarWashAgent<a class="headerlink" href="#step-5-update-the-carwashagent" title="Permanent link"></a></h3>
<p>The <code>CarWashAgent</code> needs to read from the <code>CarWashFeedbackAgent</code>’s output.</p>
<p>Update <code>src/main/java/com/carmanagement/agentic/agents/CarWashAgent.java</code>:</p>
<div class="highlight"><span class="filename">CarWashAgent.java</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents</span><span class="p">;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.tools.CarWashTool</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.SystemMessage</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.service.UserMessage</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.Agent</span><span class="p">;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkiverse.langchain4j.ToolBox</span><span class="p">;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="cm">/**</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="cm"> * Agent that determines what car wash services to request.</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="cm"> */</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CarWashAgent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="nd">@SystemMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="s">        You handle intake for the car wash department of a car rental company.</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">    </span><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="s">        Taking into account all provided feedback, determine if the car needs a car wash.</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="s">        If the feedback indicates the car is dirty, has stains, or any other cleanliness issues,</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="s">        call the provided tool and recommend appropriate car wash services (exterior wash, interior cleaning, waxing, detailing).</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="s">        Be specific about what services are needed.</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="s">        If no specific car wash request is provided, request a standard exterior wash.</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="s">        Car Information:</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="s">        Car Number: {carNumber}</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="s">        Car Wash Request:</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="s">        {carWashRequest}</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">    </span><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car wash specialist. Determines what car wash services are needed."</span><span class="p">,</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">            </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carWashAgentResult"</span><span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span><span class="nd">@ToolBox</span><span class="p">(</span><span class="n">CarWashTool</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">processCarWash</span><span class="p">(</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">);</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key change:</strong></p>
<p>Now takes <code>carWashRequest</code> as input (instead of analyzing raw feedback itself). 
This follows the separation of concerns principle:</p>
<ul>
<li>Feedback agents: Analyze and decide</li>
<li>Action agents: Execute based on decisions</li>
</ul>
<hr>
<h2 id="part-4-create-the-conditional-action-workflow">Part 4: Create the Conditional Action Workflow<a class="headerlink" href="#part-4-create-the-conditional-action-workflow" title="Permanent link"></a></h2>
<p>Now we’ll create a workflow that <strong>conditionally</strong> executes agents based on the feedback analysis.</p>
<h3 id="step-6-create-the-actionworkflow">Step 6: Create the ActionWorkflow<a class="headerlink" href="#step-6-create-the-actionworkflow" title="Permanent link"></a></h3>
<p>In <code>src/main/java/com/carmanagement/agentic/workflow</code>, create <code>ActionWorkflow.java</code>:</p>
<div class="highlight"><span class="filename">ActionWorkflow.java</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow</span><span class="p">;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.CarWashAgent</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.MaintenanceAgent</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.ActivationCondition</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.ConditionalAgent</span><span class="p">;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.SubAgent</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="cm">/**</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="cm"> * Workflow for processing car actions conditionally.</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="cm"> */</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ActionWorkflow</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="cm">     * Runs the appropriate action agent based on the feedback analysis.</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="cm">     */</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="nd">@ConditionalAgent</span><span class="p">(</span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"actionResult"</span><span class="p">,</span><span class="w"> </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"actionResult"</span><span class="p">),</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarWashAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"actionResult"</span><span class="p">)</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">processAction</span><span class="p">(</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">,</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">    </span><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">activateMaintenance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">    </span><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">CarWashAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">activateCarWash</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">carWashRequest</span><span class="p">);</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">"NOT_REQUIRED"</span><span class="p">);</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Let’s break it down:</strong></p>
<h4 id="conditionalagent-annotation"><code>@ConditionalAgent</code> Annotation<a class="headerlink" href="#conditionalagent-annotation" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nd">@ConditionalAgent</span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"actionResult"</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"actionResult"</span><span class="p">),</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">        </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarWashAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"actionResult"</span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="p">)</span>
</code></pre></div>
<p>A <strong>conditional workflow</strong> is a sequence where each agent only runs if its condition is met.</p>
<h4 id="activationcondition-methods"><code>@ActivationCondition</code> Methods<a class="headerlink" href="#activationcondition-methods" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">MaintenanceAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">activateMaintenance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">);</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="nd">@ActivationCondition</span><span class="p">(</span><span class="n">CarWashAgent</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">activateCarWash</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">isRequired</span><span class="p">(</span><span class="n">carWashRequest</span><span class="p">);</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">}</span>
</code></pre></div>
<p>These methods control when each agent executes:</p>
<ul>
<li><strong><code>activateMaintenance</code></strong>: Returns <code>true</code> if maintenance is needed</li>
<li><strong><code>activateCarWash</code></strong>: Returns <code>true</code> if car wash is needed</li>
</ul>
<p>This logic is defined in the <code>isRequired</code> method:
</p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">"NOT_REQUIRED"</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">}</span>
</code></pre></div>
<p>The parameters are automatically extracted from <strong><em>AgenticScope</em></strong>’s state by name.</p>
<h4 id="execution-logic">Execution Logic<a class="headerlink" href="#execution-logic" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>if (activateMaintenance(maintenanceRequest) == true)
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    → Execute MaintenanceAgent
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    → Skip CarWashAgent (regardless of its condition)
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>else if (activateCarWash(carWashRequest) == true)
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    → Execute CarWashAgent
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>else
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    → Skip both agents
</code></pre></div>
<p>This implements <em>priority routing</em>: maintenance takes precedence over car wash.</p>
<hr>
<h2 id="part-5-update-the-car-condition-agent">Part 5: Update the Car Condition Agent<a class="headerlink" href="#part-5-update-the-car-condition-agent" title="Permanent link"></a></h2>
<h3 id="step-7-update-carconditionfeedbackagent">Step 7: Update CarConditionFeedbackAgent<a class="headerlink" href="#step-7-update-carconditionfeedbackagent" title="Permanent link"></a></h3>
<p>The condition agent should now use the analyzed requests instead of raw feedback.</p>
<p>Update <code>src/main/java/com/carmanagement/agentic/agents/CarConditionFeedbackAgent.java</code>:</p>
<div class="highlight"><span class="filename">CarConditionFeedbackAgent.java</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nd">@UserMessage</span><span class="p">(</span><span class="s">"""</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="s">        Car Information:</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="s">        Make: {carMake}</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="s">        Model: {carModel}</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="s">        Year: {carYear}</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="s">        Previous Condition: {carCondition}</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="s">        Feedback from other agents:</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="s">        Car Wash Recommendation: {carWashRequest}</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="s">        Maintenance Recommendation: {maintenanceRequest}</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="s">        """</span><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="nd">@Agent</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Car condition analyzer. Determines the current condition of a car based on feedback."</span><span class="p">,</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">        </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carCondition"</span><span class="p">)</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="n">String</span><span class="w"> </span><span class="nf">analyzeForCondition</span><span class="p">(</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">,</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">);</span>
</code></pre></div>
<p><strong>Key changes:</strong></p>
<ul>
<li>Now takes <code>carWashRequest</code> and <code>maintenanceRequest</code> as inputs</li>
<li>Uses the analyzed requests (which include reasoning) to determine condition</li>
<li>More accurate condition updates based on professional analysis</li>
</ul>
<hr>
<h2 id="part-6-create-supporting-infrastructure">Part 6: Create Supporting Infrastructure<a class="headerlink" href="#part-6-create-supporting-infrastructure" title="Permanent link"></a></h2>
<h3 id="step-8-create-the-maintenancetool">Step 8: Create the MaintenanceTool<a class="headerlink" href="#step-8-create-the-maintenancetool" title="Permanent link"></a></h3>
<p>In <code>src/main/java/com/carmanagement/agentic/tools</code>, create <code>MaintenanceTool.java</code>:</p>
<div class="highlight"><span class="filename">MaintenanceTool.java</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.tools</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarInfo</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarStatus</span><span class="p">;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agent.tool.Tool</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.Dependent</span><span class="p">;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional</span><span class="p">;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="cm">/**</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="cm"> * Tool for requesting car maintenance operations.</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="cm"> */</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="nd">@Dependent</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MaintenanceTool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="cm">     * Requests maintenance for a car based on the provided parameters.</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="cm">     *</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="cm">     * @param carNumber The car number</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="cm">     * @param carMake The car make</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="cm">     * @param carModel The car model</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="cm">     * @param carYear The car year</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="cm">     * @param oilChange Whether to request an oil change</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="cm">     * @param tireRotation Whether to request tire rotation</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="cm">     * @param brakeService Whether to request brake service</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="cm">     * @param engineService Whether to request engine service</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="cm">     * @param transmissionService Whether to request transmission service</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="cm">     * @param requestText The maintenance request text</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="cm">     * @return A summary of the maintenance request</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="cm">     */</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">    </span><span class="nd">@Tool</span><span class="p">(</span><span class="s">"Requests maintenance with the specified options"</span><span class="p">)</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">    </span><span class="nd">@Transactional</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">requestMaintenance</span><span class="p">(</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">oilChange</span><span class="p">,</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tireRotation</span><span class="p">,</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">brakeService</span><span class="p">,</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">engineService</span><span class="p">,</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">transmissionService</span><span class="p">,</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">requestText</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="w">        </span><span class="c1">// In a more elaborate implementation, we might make an API call to a maintenance service here</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w">        </span><span class="c1">// Update car status to IN_MAINTENANCE</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="w">        </span><span class="n">CarInfo</span><span class="w"> </span><span class="n">carInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarInfo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">carNumber</span><span class="p">);</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carInfo</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w">            </span><span class="n">carInfo</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarStatus</span><span class="p">.</span><span class="na">IN_MAINTENANCE</span><span class="p">;</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w">            </span><span class="n">carInfo</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="w">        </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="w">        </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"Maintenance requested for "</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">carMake</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a><span class="w">               </span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">carModel</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">" ("</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">carYear</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">"), Car #"</span><span class="p">)</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="w">               </span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">carNumber</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">":\n"</span><span class="p">);</span>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oilChange</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Oil change\n"</span><span class="p">);</span>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tireRotation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Tire rotation\n"</span><span class="p">);</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">brakeService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Brake service\n"</span><span class="p">);</span>
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">engineService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Engine service\n"</span><span class="p">);</span>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">transmissionService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"- Transmission service\n"</span><span class="p">);</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestText</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">requestText</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a><span class="w">            </span><span class="n">summary</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"Additional notes: "</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">requestText</span><span class="p">);</span>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"MaintenanceTool result: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a><span class="p">}</span>
</code></pre></div>
<p>Similar to <code>CarWashTool</code>, this tool:</p>
<ul>
<li>Uses <code>@Dependent</code> scope (required for tool detection)</li>
<li>Provides maintenance options: oil change, tire rotation, brake service, etc.</li>
<li>Updates car status to <code>IN_MAINTENANCE</code></li>
<li>Returns a summary of requested services</li>
</ul>
<h3 id="step-9-create-the-requiredaction-model">Step 9: Create the RequiredAction Model<a class="headerlink" href="#step-9-create-the-requiredaction-model" title="Permanent link"></a></h3>
<p>We need a model to represent what action is required for a car.</p>
<p>In <code>src/main/java/com/carmanagement/model</code>, create <code>RequiredAction.java</code>:</p>
<div class="highlight"><span class="filename">RequiredAction.java</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.model</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="cm">/**</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="cm"> * Enum representing the type of possible required actions for car processing</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="cm"> */</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">RequiredAction</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="n">MAINTENANCE</span><span class="p">,</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="n">CAR_WASH</span><span class="p">,</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="n">NONE</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="p">}</span>
</code></pre></div>
<h3 id="step-10-update-the-carconditions-model">Step 10: Update the CarConditions Model<a class="headerlink" href="#step-10-update-the-carconditions-model" title="Permanent link"></a></h3>
<p>Update <code>src/main/java/com/carmanagement/model/CarConditions.java</code>:</p>
<p></p><div class="highlight"><span class="filename">CarConditions.java</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.model</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CarConditions</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">generalCondition</span><span class="p">,</span><span class="w"> </span><span class="n">RequiredAction</span><span class="w"> </span><span class="n">requiredAction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="p">}</span>
</code></pre></div>
Notice how it has changed from <code>boolean carWashRequired</code> to <code>RequiredAction requiredAction</code> to support three states.
<h3 id="step-11-add-maintenance-returns-api">Step 11: Add Maintenance Returns API<a class="headerlink" href="#step-11-add-maintenance-returns-api" title="Permanent link"></a></h3>
<p>Update <code>src/main/java/com/carmanagement/resource/CarManagementResource.java</code>:</p>
<div class="highlight"><span class="filename">CarManagementResource.java</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="cm">/**</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="cm"> * Process a car return from maintenance.</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="cm"> *</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="cm"> * @param carNumber The car number</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="cm"> * @param maintenanceFeedback Optional maintenance feedback</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="cm"> * @return Result of the processing</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="cm"> */</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="nd">@POST</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">"/maintenance-return/{carNumber}"</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">processMaintenanceReturn</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span><span class="w"> </span><span class="nd">@RestQuery</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carManagementService</span><span class="p">.</span><span class="na">processCarReturn</span><span class="p">(</span><span class="n">carNumber</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="na">Status</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">)</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">                </span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="s">"Error processing maintenance return: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="p">}</span>
</code></pre></div>
<p>This adds a new endpoint for the maintenance team to return cars with feedback.</p>
<hr>
<h2 id="part-7-update-the-main-workflow">Part 7: Update the Main Workflow<a class="headerlink" href="#part-7-update-the-main-workflow" title="Permanent link"></a></h2>
<h3 id="step-12-update-carprocessingworkflow">Step 12: Update CarProcessingWorkflow<a class="headerlink" href="#step-12-update-carprocessingworkflow" title="Permanent link"></a></h3>
<p>This is where everything comes together! Update the workflow to use nested workflows.</p>
<p>Update <code>src/main/java/com/carmanagement/agentic/workflow/CarProcessingWorkflow.java</code>:</p>
<div class="highlight"><span class="filename">CarProcessingWorkflow.java</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.agents.CarConditionFeedbackAgent</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarConditions</span><span class="p">;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.RequiredAction</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.Output</span><span class="p">;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.SequenceAgent</span><span class="p">;</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dev.langchain4j.agentic.declarative.SubAgent</span><span class="p">;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="cm">/**</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="cm"> * Workflow for processing car returns using a sequence of agents.</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="cm"> */</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CarProcessingWorkflow</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="cm">     * Processes a car return by running feedback analysis and then appropriate actions.</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="cm">     */</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">    </span><span class="nd">@SequenceAgent</span><span class="p">(</span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">,</span><span class="w"> </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FeedbackWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">),</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">),</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">            </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarConditionFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">)</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="n">CarConditions</span><span class="w"> </span><span class="nf">processCarReturn</span><span class="p">(</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carMake</span><span class="p">,</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carModel</span><span class="p">,</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">carYear</span><span class="p">,</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">carWashFeedback</span><span class="p">,</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">);</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">    </span><span class="nd">@Output</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">CarConditions</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">        </span><span class="n">RequiredAction</span><span class="w"> </span><span class="n">requiredAction</span><span class="p">;</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">        </span><span class="c1">// Check maintenance first (higher priority)</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="w">            </span><span class="n">requiredAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">MAINTENANCE</span><span class="p">;</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRequired</span><span class="p">(</span><span class="n">carWashRequest</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">            </span><span class="n">requiredAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">CAR_WASH</span><span class="p">;</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="w">            </span><span class="n">requiredAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">NONE</span><span class="p">;</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CarConditions</span><span class="p">(</span><span class="n">carCondition</span><span class="p">,</span><span class="w"> </span><span class="n">requiredAction</span><span class="p">);</span>
<a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a>
<a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">"NOT_REQUIRED"</span><span class="p">);</span>
<a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Let’s break it down:</strong></p>
<h4 id="the-sequence">The Sequence<a class="headerlink" href="#the-sequence" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nd">@SequenceAgent</span><span class="p">(</span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">,</span><span class="w"> </span><span class="n">subAgents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FeedbackWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">),</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionWorkflow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">),</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="nd">@SubAgent</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarConditionFeedbackAgent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">outputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"carProcessingAgentResult"</span><span class="p">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="p">})</span>
</code></pre></div>
<p>Notice the subagents include <strong>workflows</strong> (<code>FeedbackWorkflow</code>, <code>ActionWorkflow</code>), not just agents!</p>
<p>This is <strong>workflow composition</strong>: workflows can contain other workflows.</p>
<h4 id="the-execution-order">The Execution Order<a class="headerlink" href="#the-execution-order" title="Permanent link"></a></h4>
<ol>
<li><strong>FeedbackWorkflow</strong> (parallel): Analyzes feedback for both maintenance and car wash needs</li>
<li><strong>ActionWorkflow</strong> (conditional): Routes the car to maintenance or car wash based on analysis</li>
<li><strong>CarConditionFeedbackAgent</strong> (single): Updates the car’s overall condition</li>
</ol>
<h4 id="the-output-method">The @Output Method<a class="headerlink" href="#the-output-method" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nd">@Output</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="kd">static</span><span class="w"> </span><span class="n">CarConditions</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">carCondition</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceRequest</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">carWashRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="n">RequiredAction</span><span class="w"> </span><span class="n">requiredAction</span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRequired</span><span class="p">(</span><span class="n">maintenanceRequest</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">        </span><span class="n">requiredAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">MAINTENANCE</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRequired</span><span class="p">(</span><span class="n">carWashRequest</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">        </span><span class="n">requiredAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">CAR_WASH</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">        </span><span class="n">requiredAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">NONE</span><span class="p">;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CarConditions</span><span class="p">(</span><span class="n">carCondition</span><span class="p">,</span><span class="w"> </span><span class="n">requiredAction</span><span class="p">);</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="p">}</span>
</code></pre></div>
<p>This static method extracts three values from AgenticScope’s state and combines them into the final result.</p>
<hr>
<h2 id="part-8-update-the-service-layer">Part 8: Update the Service Layer<a class="headerlink" href="#part-8-update-the-service-layer" title="Permanent link"></a></h2>
<h3 id="step-13-update-carmanagementservice">Step 13: Update CarManagementService<a class="headerlink" href="#step-13-update-carmanagementservice" title="Permanent link"></a></h3>
<p>And to get things over the finish line, we need to update the car management service to handle the new workflow structure.</p>
<p>Update <code>src/main/java/com/carmanagement/service/CarManagementService.java</code>:</p>
<div class="highlight"><span class="filename">CarManagementService.java</span><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.carmanagement.service</span><span class="p">;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.agentic.workflow.CarProcessingWorkflow</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarConditions</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarInfo</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.CarStatus</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.carmanagement.model.RequiredAction</span><span class="p">;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional</span><span class="p">;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="cm">/**</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="cm"> * Service for managing car returns from various operations.</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="cm"> */</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CarManagementService</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="nd">@Inject</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="n">CarProcessingWorkflow</span><span class="w"> </span><span class="n">carProcessingWorkflow</span><span class="p">;</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="cm">     * Process a car return from any operation.</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="cm">     *</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="cm">     * @param carNumber The car number</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="cm">     * @param rentalFeedback Optional rental feedback</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="cm">     * @param carWashFeedback Optional car wash feedback</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="cm">     * @param maintenanceFeedback Optional maintenance feedback</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="cm">     * @return Result of the processing</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="cm">     */</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">    </span><span class="nd">@Transactional</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">processCarReturn</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">carNumber</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">carWashFeedback</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w">        </span><span class="n">CarInfo</span><span class="w"> </span><span class="n">carInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarInfo</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">carNumber</span><span class="p">);</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">"Car not found with number: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carNumber</span><span class="p">;</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="w">        </span><span class="c1">// Process the car return using the workflow and get the AgenticScope</span>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="w">        </span><span class="n">CarConditions</span><span class="w"> </span><span class="n">carConditions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carProcessingWorkflow</span><span class="p">.</span><span class="na">processCarReturn</span><span class="p">(</span>
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">make</span><span class="p">,</span>
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">model</span><span class="p">,</span>
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">year</span><span class="p">,</span>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="w">                </span><span class="n">carNumber</span><span class="p">,</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="w">                </span><span class="n">carInfo</span><span class="p">.</span><span class="na">condition</span><span class="p">,</span>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a><span class="w">                </span><span class="n">rentalFeedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">rentalFeedback</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="w">                </span><span class="n">carWashFeedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">carWashFeedback</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="w">                </span><span class="n">maintenanceFeedback</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">maintenanceFeedback</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">""</span><span class="p">);</span>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a>
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a><span class="w">        </span><span class="c1">// Update the car's condition with the result from CarConditionFeedbackAgent</span>
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="w">        </span><span class="n">carInfo</span><span class="p">.</span><span class="na">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carConditions</span><span class="p">.</span><span class="na">generalCondition</span><span class="p">();</span>
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="w">        </span><span class="c1">// If no action is required, then the car should be available for the next rental</span>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carConditions</span><span class="p">.</span><span class="na">requiredAction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RequiredAction</span><span class="p">.</span><span class="na">NONE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="w">            </span><span class="n">carInfo</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CarStatus</span><span class="p">.</span><span class="na">AVAILABLE</span><span class="p">;</span>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a>
<a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a><span class="w">        </span><span class="c1">// Persist the changes to the database</span>
<a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a><span class="w">        </span><span class="n">carInfo</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
<a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>
<a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">carConditions</span><span class="p">.</span><span class="na">generalCondition</span><span class="p">();</span>
<a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Key changes:</strong></p>
<ul>
<li>Now passes <code>maintenanceFeedback</code> parameter to the workflow</li>
<li>Uses <code>RequiredAction</code> enum to determine car status</li>
<li>Sets status to <code>IN_MAINTENANCE</code> or <code>AT_CAR_WASH</code> based on the required action</li>
</ul>
<hr>
<h2 id="try-it-out">Try It Out<a class="headerlink" href="#try-it-out" title="Permanent link"></a></h2>
<p>Start the application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>./mvnw<span class="w"> </span>quarkus:dev
</code></pre></div>
<p>Open <a href="http://localhost:8080" target="_blank">http://localhost:8080</a>.</p>
<h3 id="notice-the-new-ui">Notice the New UI<a class="headerlink" href="#notice-the-new-ui" title="Permanent link"></a></h3>
<p>The <strong>Returns</strong> section now has a <strong>Maintenance Return</strong> tab:</p>
<p><img alt="Maintenance Returns Tab" class="center" src="../../images/agentic-UI-maintenance-returns-tab.png"></p>
<h3 id="test-the-complete-workflow">Test the Complete Workflow<a class="headerlink" href="#test-the-complete-workflow" title="Permanent link"></a></h3>
<p>Enter feedback on the Maintenance Return tab for car 3:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>buffed out the scratch. car could use a wash now.
</code></pre></div>
<p>Click <strong>Return</strong>.</p>
<p><strong>What happens?</strong></p>
<ol>
<li><strong>Parallel Analysis</strong> (FeedbackWorkflow):</li>
<li><code>MaintenanceFeedbackAgent</code>: “MAINTENANCE_NOT_REQUIRED” (scratch fixed)</li>
<li>
<p><code>CarWashFeedbackAgent</code>: “Car wash needed for general cleaning”</p>
</li>
<li>
<p><strong>Conditional Routing</strong> (ActionWorkflow):</p>
</li>
<li>Maintenance condition: <code>false</code> (not required)</li>
<li>Car wash condition: <code>true</code> (required)</li>
<li>
<p>→ Executes <code>CarWashAgent</code>, sends car to car wash</p>
</li>
<li>
<p><strong>Condition Update</strong> (CarConditionFeedbackAgent):</p>
</li>
<li>
<p>Updates car condition: “Scratch removed, clean overall”</p>
</li>
<li>
<p><strong>UI Update</strong>:</p>
</li>
<li>Car status → <code>AT_CAR_WASH</code></li>
<li>Condition column updates</li>
</ol>
<h3 id="check-the-logs">Check the Logs<a class="headerlink" href="#check-the-logs" title="Permanent link"></a></h3>
<p>Look for evidence of parallel execution:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>[MaintenanceFeedbackAgent] MAINTENANCE_NOT_REQUIRED - Scratch has been repaired
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>[CarWashFeedbackAgent] Recommend exterior wash and interior cleaning
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>🚗 CarWashTool result: Car wash requested for Honda Civic (2020), Car #3:
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>- Exterior wash
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>- Interior cleaning
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>[CarConditionFeedbackAgent] Good condition, scratch repaired, recently cleaned
</code></pre></div>
<p>Notice how both feedback agents’ responses appear close together in time (parallel execution)!</p>
<hr>
<h2 id="how-it-all-works-together">How It All Works Together<a class="headerlink" href="#how-it-all-works-together" title="Permanent link"></a></h2>
<p>Let’s trace a complete example with maintenance needed:</p>
<h3 id="example-strange-engine-noise">Example: “Strange engine noise”<a class="headerlink" href="#example-strange-engine-noise" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>Rental feedback: "Engine making strange knocking sound"
</code></pre></div>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant Main as CarProcessingWorkflow
    participant Feedback as FeedbackWorkflow
    participant Action as ActionWorkflow
    participant Scope as AgenticScope State

    User-&gt;&gt;Main: Return car with feedback
    Main-&gt;&gt;Scope: Store: rentalFeedback="Engine knocking"

    rect rgb(255, 243, 205)
    Note over Main,Feedback: Parallel Workflow
    Main-&gt;&gt;Feedback: Execute
    par
        Feedback-&gt;&gt;Scope: MaintenanceFeedbackAgent&lt;br/&gt;Write: "Engine service needed - knocking sound"
    and
        Feedback-&gt;&gt;Scope: CarWashFeedbackAgent&lt;br/&gt;Write: "CARWASH_NOT_REQUIRED"
    end
    end

    rect rgb(248, 215, 218)
    Note over Main,Action: Conditional Workflow
    Main-&gt;&gt;Action: Execute
    Action-&gt;&gt;Scope: Read: maintenanceRequest, carWashRequest
    Action-&gt;&gt;Action: activateMaintenance() = true
    Action-&gt;&gt;Scope: MaintenanceAgent executes&lt;br/&gt;Write: "Maintenance requested: engine service"
    Note over Action: CarWashAgent skipped (condition false)
    end

    Main-&gt;&gt;Scope: CarConditionFeedbackAgent&lt;br/&gt;Write: "Requires engine inspection"

    Main-&gt;&gt;Main: @Output combines results
    Main-&gt;&gt;User: CarConditions(condition="Requires engine inspection", action=MAINTENANCE)</code></pre>
<hr>
<h2 id="understanding-workflow-composition">Understanding Workflow Composition<a class="headerlink" href="#understanding-workflow-composition" title="Permanent link"></a></h2>
<p>The power of this system comes from <strong>composability</strong> — complex workflows built from simple pieces.
We keep control on the flow, while letting agents focus on their specific tasks.</p>
<h3 id="building-blocks">Building Blocks<a class="headerlink" href="#building-blocks" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CarWashFeedbackAgent</code></td>
<td>Agent</td>
<td>Analyzes cleaning needs</td>
</tr>
<tr>
<td><code>MaintenanceFeedbackAgent</code></td>
<td>Agent</td>
<td>Analyzes maintenance needs</td>
</tr>
<tr>
<td><code>FeedbackWorkflow</code></td>
<td>Parallel Workflow</td>
<td>Runs both analyses concurrently</td>
</tr>
<tr>
<td><code>CarWashAgent</code></td>
<td>Agent</td>
<td>Requests car washing</td>
</tr>
<tr>
<td><code>MaintenanceAgent</code></td>
<td>Agent</td>
<td>Requests maintenance</td>
</tr>
<tr>
<td><code>ActionWorkflow</code></td>
<td>Conditional Workflow</td>
<td>Routes to appropriate action</td>
</tr>
<tr>
<td><code>CarConditionFeedbackAgent</code></td>
<td>Agent</td>
<td>Updates car condition</td>
</tr>
<tr>
<td><code>CarProcessingWorkflow</code></td>
<td>Sequence Workflow</td>
<td>Orchestrates everything</td>
</tr>
</tbody>
</table>
<h3 id="composition-hierarchy">Composition Hierarchy<a class="headerlink" href="#composition-hierarchy" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>CarProcessingWorkflow (Sequence)
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>├── FeedbackWorkflow (Parallel)
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>│   ├── CarWashFeedbackAgent
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>│   └── MaintenanceFeedbackAgent
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>├── ActionWorkflow (Conditional)
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>│   ├── MaintenanceAgent (with MaintenanceTool)
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>│   └── CarWashAgent (with CarWashTool)
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>└── CarConditionFeedbackAgent
</code></pre></div>
<p>This is a <strong>three-level</strong> nested workflow!</p>
<hr>
<h2 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link"></a></h2>
<ul>
<li><strong>Workflows compose</strong>: Build complex systems by nesting simple workflows</li>
<li><strong>Parallel workflows improve response time</strong>: Independent tasks run concurrently</li>
<li><strong>Conditional workflows enable routing</strong>: Execute different paths based on runtime conditions</li>
<li><strong>Activation conditions are powerful</strong>: Control agent execution with simple boolean logic</li>
<li><strong>Separation of concerns</strong>: Analysis agents separate from action agents for clarity</li>
<li><strong>Type safety throughout</strong>: Compile-time checks on the entire workflow structure</li>
</ul>
<hr>
<h2 id="experiment-further">Experiment Further<a class="headerlink" href="#experiment-further" title="Permanent link"></a></h2>
<h3 id="1-add-priority-levels">1. Add Priority Levels<a class="headerlink" href="#1-add-priority-levels" title="Permanent link"></a></h3>
<p>What if you wanted to add a third level of priority (e.g., emergency repairs)?</p>
<ul>
<li>Add an <code>EmergencyRepairFeedbackAgent</code></li>
<li>Update <code>ActionWorkflow</code> with a third condition</li>
<li>Ensure emergency repairs take highest priority</li>
</ul>
<h3 id="2-make-feedback-analysis-sequential">2. Make Feedback Analysis Sequential<a class="headerlink" href="#2-make-feedback-analysis-sequential" title="Permanent link"></a></h3>
<p>Try changing <code>FeedbackWorkflow</code> from <code>@ParallelAgent</code> to <code>@SequenceAgent</code>. How does this affect performance? When might you want sequential analysis?</p>
<h3 id="3-add-more-sophisticated-conditions">3. Add More Sophisticated Conditions<a class="headerlink" href="#3-add-more-sophisticated-conditions" title="Permanent link"></a></h3>
<p>The <code>ActionWorkflow</code> currently uses simple <code>isRequired()</code> checks. Try adding:</p>
<ul>
<li>Cost-based conditions (only send to maintenance if estimated cost &lt; $500)</li>
<li>Time-based conditions (skip car wash if it was washed in last 24 hours)</li>
<li>Severity-based conditions (emergency repairs vs. routine maintenance)</li>
</ul>
<h3 id="4-visualize-the-workflow">4. Visualize the Workflow<a class="headerlink" href="#4-visualize-the-workflow" title="Permanent link"></a></h3>
<p>Add logging to each agent and workflow to print when they start and finish. Observe the parallel execution in the logs!</p>
<hr>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link"></a></h2>
<details class="warning">
<summary>Parallel agents not executing in parallel</summary>
<p>Check that your system has multiple CPU cores and that the thread pool is configured properly. In development mode, Quarkus should handle this automatically.</p>
</details>
<details class="warning">
<summary>Conditional workflow always/never executing certain agents</summary>
<ul>
<li>Verify your <code>@ActivationCondition</code> methods are correctly named</li>
<li>Check that parameter names match the <code>outputName</code> values exactly</li>
<li>Add logging to the condition methods to see what values they’re receiving</li>
</ul>
</details>
<details class="warning">
<summary>Error: Cannot find symbol ‘RequiredAction’</summary>
<p>Make sure you created both:</p>
<ul>
<li>The <code>RequiredAction</code> enum</li>
<li>Updated <code>CarConditions</code> to use it</li>
</ul>
</details>
<details class="warning">
<summary>Agents getting wrong input values</summary>
<p>Remember that parameter names must match the <code>outputName</code> from previous agents or workflow inputs. Check for typos!</p>
</details>
<hr>
<h2 id="whats-next">What’s Next?<a class="headerlink" href="#whats-next" title="Permanent link"></a></h2>
<p>You’ve built a sophisticated multi-level nested workflow combining sequence, parallel, and conditional execution!</p>
<p>In <strong>Step 04</strong>, you’ll learn about <strong>Agent-to-Agent (A2A) communication</strong> — connecting your workflows to remote agents running in separate systems!</p>
<p><a href="../step-04/">Continue to Step 04 - Using Remote Agents (A2A)</a></p></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../step-02/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Step 2 - Composing simple agent workflows">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Step 2 - Composing simple agent workflows
              </div>
            </div>
          </a>
        
        
          
          <a href="../step-04/" class="md-footer__link md-footer__link--next" aria-label="Next: Step 4 - Using remote agents (A2A)">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Step 4 - Using remote agents (A2A)
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!--
  Copyright (c) 2016-2022 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Copyright and theme information, adapter to have the Red Hat footer -->
<div class="md-copyright">
    <div class="md-copyright__highlight">
        Sponsored by <a href="https://www.redhat.com"><img style="vertical-align: middle;" alt="Red Hat" src="../../images/redhat_reversed.svg"/></a> <br/>
        <a href="https://creativecommons.org/licenses/by/3.0/">CC by 3.0</a> |
        <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </div>
    
    Made with
    <a
            href="https://squidfunk.github.io/mkdocs-material/"
            target="_blank" rel="noopener"
    >
        Material for MkDocs
    </a>
    
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "content.tabs.link", "content.code.annotate", "navigation.instant", "navigation.indexes", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky", "content.code.select", "content.code.copy"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>